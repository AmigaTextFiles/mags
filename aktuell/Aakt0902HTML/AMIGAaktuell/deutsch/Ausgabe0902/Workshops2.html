<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
<TITLE>Workshops</TITLE>
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000" LINK="#0000AA" ALINK="#000066" VLINK="#000066">
<TABLE width="100%" border="0" cellpadding="3" cellspacing="0">
<TR>
<TD BGCOLOR="#000000">
<A HREF="Workshops1.html"><IMG SRC="../menu/links.png" BORDER="0" WIDTH="15" HEIGHT="15" ALT="&lt;&lt;"></A>
<A HREF="Workshops.html"><IMG SRC="../menu/hoch.png" BORDER="0" WIDTH="15" HEIGHT="15" ALT="Inhalt"></A>
<A HREF="Workshops3.html"><IMG SRC="../menu/rechts.png" BORDER="0" WIDTH="15" HEIGHT="15" ALT="&gt;&gt;"></A>
<FONT COLOR="#FFFFFF">
Workshops
</FONT>
</TD><TD ALIGN="RIGHT" BGCOLOR="#000000">
<A HREF="index.html" TARGET="_top"><IMG SRC="../menu/inhalt.png" BORDER="0" WIDTH="36" HEIGHT="15" ALT="Inhalt"></A>
</TD></TR>
</TABLE>
<BR>
<H2>2. Workshop: Monatskalender in PHP (von Michael Christoph)</H2>
<P>
PHP ist eine moderne Internetskriptsprache (eine Mischung aus Basic, C und
Perl) und liegt auch in der aktuellen Version 4.0 f&uuml;r den Amiga vor.
Da es sich im Gegensatz zu JavaScript um eine serverseitige
Programmiersprache handelt, ist ein laufender Webserver zwingende
Voraussetzung f&uuml;r das Erstellen, Testen und Laufen lassen von PHP-Skripten.
Auch diese Aufgabe meistert der Amiga mit dem Apache-Webserver souver&auml;n.
</P>
<H3>* Die Installationsanweisungen gibt es woanders</H3>
<P>
Soviel als Einleitung zu PHP. Grundlagen und Installationsanleitungen
finden sich im Amiga-Magazin 08/2001 bzw. auch online unter
<A HREF="http://www.meicky-soft.de/amiga-magazin/mysql.html" TARGET="_top">http://www.meicky-soft.de/amiga-magazin/mysql.html</A>
</P>
<H3>* Ein paar einleitende Worte</H3>
<P>
Ich will hier keinen Einstiegskurs in die PHP-Programmierung beginnen, wer
aber bereits (in anderen Sprachen) programmieren kann und sich f&uuml;r PHP
interessiert, sollte trotzdem gut zurechtkommen.
</P>
<P>
Und im Gegensatz zu anderen Publikationen und Vorgehensweisen werde ich
sofort mit dem fertigen Beispiel beginnen, das dann Schritt f&uuml;r Schritt
genauer betrachtet wird. Dabei handelt es sich auch schon um ein sehr
praktisches Beispiel und nicht die in B&uuml;cher oft zu findenden dreizeiligen
Kurzbeispiele. Trotzdem soll dieses Beispiel lediglich als Grundlage
dienen, das jeder nach seinen W&uuml;nschen noch weiter ausbauen
kann.
</P>
<H3>* Das Beispiel</H3>
<P>
 <A HREF="img/php-kalender.png"><IMG SRC="thumb/php-kalender.jpg" WIDTH="120" HEIGHT="78" ALT="Screenshot"  BORDER="0"></A>
</P>
<PRE>
 1 &lt;?php
 2   /* kalender.php */
 3   /* 01.08.2002, Michael Christoph &lt;michael2meicky-soft.de&gt; */
 4
 5
 6   /* Hilfsfunktion zur Ermittlung von Feiertagen */
 7   function isFeiertag($m,$d,$y)
 8   {
 9     /* es wird nur der Sonntag als Feiertag erkannt */
10     if( date(&quot;w&quot;,mktime(1,1,1,$m,$d,$y)) == 0 )
11       return 'red';
12     else
13       return 'black';
14   }
15
16
17   /* erstes Element leer, damit Monat 1 = Januar ist */
18   $monatstr = array(&quot;&quot;, &quot;Januar&quot;, &quot;Februar&quot;, &quot;M&auml;rz&quot;, &quot;April&quot;, &quot;Mai&quot;,
                       &quot;Juni&quot;, &quot;Juli&quot;, &quot;August&quot;, &quot;September&quot;, &quot;Oktober&quot;,
                       &quot;November&quot;, &quot;Dezember&quot;);
19
20   /* beim ersten Aufruf den heutigen Monat und Jahr anzeigen */
21   if(!(isset($jahr)))
22   {
23     $jahr = date(&quot;Y&quot;,time());
24     $monat = date(&quot;n&quot;,time());
25   }
26   $tag = 1;
27   $timestamp = mktime(1,1,1,$monat,$tag,$jahr);
28
29   /* das Kalenderblatt als Tabelle ausgeben */
30   echo &quot;&lt;center&gt;&lt;br&gt;&lt;br&gt;&quot;;
31   echo &quot;&lt;table width='800' border='0'&gt;&quot;;
32   echo &quot;&lt;tr&gt;&quot;;
33   echo &quot;&lt;td align='center' valign='top'&gt;&quot;;
34
35   /* Link f&uuml;r vorherigen Monat erzeugen */
36   if($monat &gt; 1)
37     echo &quot;&lt;a href='kalender.php?monat=&quot; . ($monat-1) . &quot;&amp;jahr=&quot;
                    . $jahr . &quot;'&gt;&quot; . $monatstr[$monat-1] . &quot;&lt;/a&gt; &amp;lt;--- &quot;;
38   else
39     echo &quot;&lt;a href='kalender.php?monat=12&jahr=" . ($jahr-1) . "'&gt;&quot;
                                         . $monatstr[12] . &quot;&lt;/a&gt; &amp;lt;--- &quot;;
40
41   /* das aktuelle Monat dazwischen mit Jahreszahl ausgeben */
42   echo &quot; &lt;font size='5' face='tahoma'&gt;&quot; . $monatstr[$monat]
                                                        . &quot; $jahr&lt;/font&gt; &quot;;
43
44   /* Link f&uuml;r folgenden Monat erzeugen */
45   if($monat &lt; 12)
46     echo &quot; ---&amp;gt; &lt;a href='kalender.php?monat=&quot; . ($monat+1)
                  . &quot;&amp;jahr=&quot; . $jahr . &quot;'&gt;&quot; . $monatstr[$monat+1] . &quot;&lt;/a&gt;&quot;;
47   else
48     echo &quot; ---&amp;gt; &lt;a href='kalender.php?monat=1&amp;jahr=&quot; . ($jahr+1)
                                            . &quot;'&gt;&quot; . $monatstr[1] . &quot;&lt;/a&gt;&quot;;
49
50   echo &quot;&lt;table width='150' border='1'&gt;&quot;;
51
52   /* als &Uuml;berschrift die Wochentage eintragen */
53   echo &quot;&lt;th align='center' width='20'&gt;Mo&lt;/th&gt;&quot;;
54   echo &quot;&lt;th align='center' width='20'&gt;Di&lt;/th&gt;&quot;;
55   echo &quot;&lt;th align='center' width='20'&gt;Mi&lt;/th&gt;&quot;;
56   echo &quot;&lt;th align='center' width='20'&gt;Do&lt;/th&gt;&quot;;
57   echo &quot;&lt;th align='center' width='20'&gt;Fr&lt;/th&gt;&quot;;
58   echo &quot;&lt;th align='center' width='20'&gt;Sa&lt;/th&gt;&quot;;
59   echo &quot;&lt;th align='center' width='20'&gt;&lt;font color='red'&gt;So&lt;/font&gt;&lt;/th&gt;&quot;;
60   echo &quot;&lt;tr&gt;&quot;;
61
62   /* erst mal einr&uuml;cken bis zum Wochentag des 1. */
63   $wochentag = date(&quot;w&quot;,$timestamp);
64   if($wochentag == 0) $wochentag = 7;  /* 0=Sonntag */
65   for($i=1; $i&lt;$wochentag; $i++)
66   {
67     echo &quot;&lt;td align='center'&gt;&amp;nbsp;&lt;/td&gt;&quot;;
68   }
69
70   /* dann alle Tage des Monats ausgeben */
71   while(checkdate($monat,$tag,$jahr))
72   {
73     echo &quot;&lt;td align='center'&gt;&lt;font color='&quot;
                    . isFeiertag($monat,$tag,$jahr) . &quot;'&gt;$tag&lt;/font&gt;&lt;/td&gt;&quot;;
74     /* am Sonntag ist die Zeile zu Ende und eine neue wird begonnen */
75     if(isFeiertag($monat,$tag,$jahr) == &quot;red&quot;) { echo &quot;&lt;/tr&gt;&lt;tr&gt;&quot;; }
76     $tag++;
77   }
78
79   /* noch auff&uuml;llen bis zum Sonntag */
80   if(! (isFeiertag($monat,$tag-1,$jahr) == &quot;red&quot;))
81   {
82     while(! (isFeiertag($monat,$tag,$jahr) == &quot;red&quot;))
83     {
84       echo &quot;&lt;td align='center'&gt;&amp;nbsp;&lt;/td&gt;&quot;;
85       $tag++;
86     }
87     echo &quot;&lt;td align='center'&gt;&amp;nbsp;&lt;/td&gt;&quot;;
88   }
89
90   echo &quot;&lt;/tr&gt;&quot;;
91   echo &quot;&lt;/table&gt;&quot;;
92   echo &quot;&lt;/td&gt;&quot;;
93
94   echo &quot;&lt;/tr&gt;&quot;;
95   echo &quot;&lt;/table&gt;&quot;;
96   echo &quot;&lt;/center&gt;&quot;;
97
98 ?&gt;
</PRE>
<H3>* Erkl&auml;rung zum Beispiel</H3>
<P>
Das Beispiel ist lediglich zur besseren Orientierung zeilenweise
nummeriert. Die Zahlen sind nicht mit einzugeben! Zeilen ohne Nummer sind
lediglich zur besseren Lesbarkeit umgebrochen worden und einzeilig.
Speichert es unter dem Namen &quot;kalender.php&quot; ab. Wichtig ist, als Endung
&quot;.php&quot; oder &quot;.php3&quot; oder &quot;.php4&quot; oder &quot;.phps&quot; zu verwenden, um Apache
mitzuteilen, dass der Textinhalt erst noch verarbeitet werden muss, bevor
er an den Browser gesendet wird. Dabei h&auml;ngt es von der Apache-
Konfiguration ab, welche Endungen erkannt und benutzt werden k&ouml;nnen. Lokal
kann dies in Apache:conf/httpd.conf eingetragen werden, ansonsten ist beim
ISP nachzufragen.
</P>
<P>
PHP kann innerhalb eines HTML-Codes eingebettet werden, aber auch
umgekehrt, HTML-Anweisungen k&ouml;nnen von PHP-Code erzeugt werden.
Mittels &quot;&lt;?php&quot; oder auch kurz &quot;&lt;?&quot; wird der Begin eines PHP-Blocks
gekennzeichnet. Entsprechend ist &quot;?&gt;&quot; als Endmarkierung zu verwenden.
Au&szlig;erhalb dieses Blockes kann ganz normaler HTML-Code geschrieben
werden.
</P>
<P>
Das ganze Programm setzt sich lediglich aus ein paar unterschiedlichen PHP-
Funktionen zusammen. Diese werde ich hier nur kurz vorstellen.
</P>
<P>
Heutzutage gibt es eine gro&szlig;e Anzahl an PHP-Literatur. &quot;GoTo PHP 4&quot; aus dem
Addison-Wesley-Verlag (590 Seiten, 39,95 EURO mit CD) sei hier als
empfehlenswertes Beispiel genannt. Ein sehr umfangreiches (&uuml;ber 7 MByte
gro&szlig;en) PHP-Handbuch ist unter &quot;<A HREF="http://www.php.net/manual/de/" TARGET="_top">http://www.php.net/manual/de/</A>&quot; zu finden.
</P>
<UL>
<LI> isset
  dient zur &Uuml;berpr&uuml;fung, ob eine Variable gesetzt ist oder nicht.
  Wird ein PHP-Skript aufgerufen, stehen automatisch alle Aufrufoptionen
  der URL-Zeile als benannte Variablen zur Verf&uuml;gung.
  Der Aufruf &quot;<A HREF="http://localhost/kalender.php?monat=8" TARGET="_top">http://localhost/kalender.php?monat=8</A>&amp;jahr=2002&quot;
  erzeugt die beiden Variablen $monat und $jahr (Variablen werden
  durch ein vorangestelltes Dollarzeichen gekennzeichnet) und setzt
  sie auf die Werte 8 und 2002. Wird nur die Anweisung
  &quot;<A HREF="http://localhost/kalender.php" TARGET="_top">http://localhost/kalender.php</A>&quot; aufgerufen, sind beide Variablen
  nicht vorhanden.
</LI>
<BR><LI> echo
  ist wohl die wichtigste Funktion und erlaubt neben printf
  die Ausgabe von Text und HTML-Code an den aufrufenden Web-Browser.
</LI>
<BR><LI> mktime
  erlaubt die Erstellung eines sogenannten Timestamps. Der Timestamp
  kann Datum und Uhrzeit als Integerzahl repr&auml;sentieren. Zu beachten
  ist die Reihenfolge der Parameter: Stunde,Minute,Sekunde,Monat,Tag,Jahr!
</LI>
<BR><LI> date
  erlaubt die Ausgabe eines Timestamps in benutzerverst&auml;ndlicher Form.
  Anhand Platzhalterzeichen kann sehr flexibel das Ausgabeformat festgelegt
  werden (&quot;w&quot; z.B. f&uuml;r den Wochentag)
</LI>
<BR><LI> checkdate
  dient zur &Uuml;berpr&uuml;fung eines Datums auf G&uuml;ltigkeit. Zu beachten ist
  die Reihenfolge der Parameter: Monat,Tag,Jahr!
</LI>
<BR><LI> array
  erlaubt das Erstellen von Arrays. Dabei k&ouml;nnen beliebige Datentypen
  in einem Array gemischt werden (also z.B. Zahlen und Strings).
  Auch assoziative Arrays sind m&ouml;glich und werden in der Form
  &quot;name =&gt; michael&quot; geschrieben.
</LI>
<BR><LI> for
  Z&auml;hlschleife, wie in C
</LI>
<BR><LI> while
  Schleife mit Kopfbedingung, wie in C
</LI>
<BR><LI> isFeiertag
  eigene Hilfsfunktion
</LI>
</UL>
<H3>* Das Beispiel wird betrachtet</H3>
<P>
Das Beispiel beginnt eigentlich in Zeile 18, da vorher lediglich eine neue
Funktion bekannt gegeben wird. Es k&ouml;nnen auch mehr Funktionen sein bzw.
diese aus externen Dateien &quot;includiert&quot; werden.
</P>
<P>
In Zeile 18 wird lediglich ein Array erzeugt, das die Monatsnamen in
deutscher Schreibweise enth&auml;lt. Die Funktion date() liefert zwar mittels
des Platzhaltersymbols &quot;F&quot; auch den Monatsnamen, allerdings mit englischer
Bezeichnung. Da PHP (wie auch C) bei 0 zu z&auml;hlen beginnt, die Monate aber
mit 1 beginnen, wird das erste Element des Arrays leer gelassen.
</P>
<P>
Die Zeilen 21 bis 25 dienen dazu, festzustellen, ob das Skript mit oder
ohne Parameter aufgerufen wurde. Ohne Parameter (also
&quot;<A HREF="http://localhost/kalender.php" TARGET="_top">http://localhost/kalender.php</A>&quot; allein) werden der heutige Monat und Jahr
als Startwerte verwendet. Ansonsten wird dieser Programmteil gar nicht
ausgef&uuml;hrt.
</P>
<P>
Zeile 26 setzt den Tagesz&auml;hler auf 1. Er wird sp&auml;ter bei der Ausgabe
jeweils ums eins erh&ouml;ht, bis zum Monatsletzten.
</P>
<P>
Weiter geht es dann in der Zeile 27, in der aus dem Datum (und einer f&uuml;r
unser Beispiel irrelevanten Uhrzeit 1 Uhr, 1 Minute und 1 Sekunde) ein
Timestamp zur weiteren Verarbeitung generiert wird.
</P>
<P>
Die Zeilen 30 bis 33 beginnen dann mit der Erzeugung einer HTML-Tabelle.
</P>
<P>
In den Zeilen 36 bis 39 wird ein HTML-Link erzeugt, bei dessen Auswahl der
vorhergehende Monat im Browser angezeigt wird. Falls der aktuelle Monat
noch nicht Januar ist, wird der Link f&uuml;r einen Monat verringert erzeugt,
ansonsten f&uuml;r Dezember des vorhergehenden Jahres.
</P>
<P>
Zeile 42 schreibt zwischen die beiden Links den Namen des aktuellen Monats
mit Jahreszahl in einer gr&ouml;&szlig;eren Schrift.
</P>
<P>
Zeilen 45 bis 48 erzeugen entsprechend einen Link f&uuml;r den folgenden Monat.
Falls noch nicht Dezember ist, f&uuml;r den n&auml;chsten Monat, sonst f&uuml;r Januar des
darauffolgenden Jahres.
</P>
<P>
Falls das Monatsarray (Zeile 18) sofort mit &quot;Januar&quot; als ersten Eintrag
begonnen worden w&auml;re, h&auml;tte f&uuml;r die vorangegangenen Zeilen 36 bis 48
jeweils als Index [$monat-1] geschrieben werden m&uuml;ssen. Deutlich besser zu
lesen ist es allerdings ohne die -1, und auch die Fehleranf&auml;lligkeit wird
verringert.
</P>
<P>
Die Zeilen 53 bis 59 sorgen dann daf&uuml;r, dass als Tabellen&uuml;berschriften die
Wochentage verwendet werden. Dabei wird der Sonntag rot geschrieben (wie
alle sp&auml;teren Sonntage im Kalender auch).
</P>
<P>
In Zeile 63 wird ermittelt, auf welchen Wochentag der Monatserste f&auml;llt.
Das Ergebnis ist ein Zahlenwert von 0 (=Sonntag) bis 6 (=Samstag). Falls es
sich um einen Sonntag handelt, erh&ouml;hen wir in Zeile 64 den Wert auf 7. In
den folgenden Zeilen 65 bis 68 werden n&auml;mlich Wochentage-1 leere Tabellen-
Felder erzeugt.
</P>
<P>
Die eigentliche Ausgabe des Kalenders erfolgt dann in den Zeilen 71 bis 77.
Diese Schleife wird solange durchlaufen, bis das Datum nicht mehr g&uuml;ltig
ist. Dadurch werden alle Tage des Monats als einzelne Zellen ausgegeben.
Zeile 73 ist daf&uuml;r zust&auml;ndig, dass die Tage, die auf einen Sonntag fallen,
in rot ausgegeben werden.
</P>
<P>
Zeile 75 hingegen beginnt eine neue Reihe, wenn der Sonntag ausgegeben
wurde. Zeile 76 z&auml;hlt lediglich den Tagesz&auml;hler um eins hoch.
</P>
<P>
In Zeile 80 wird gepr&uuml;ft, ob das zuletzt ausgegebene Datum ein Sonntag war.
Ist dies nicht der Fall, werden die Zeilen 82 bis 87 ausgef&uuml;hrt, die daf&uuml;r
sorgen, dass noch entsprechend viele leere Zellen erzeugt werden, um die
aktuelle Reihe zu vervollst&auml;ndigen.
</P>
<P>
Die Zeilen 90 bis 96 dienen dann lediglich noch zum Abschlie&szlig;en der
Tabellenanweisungen.
</P>
<P>
Damit sollte das Beispiel doch ausf&uuml;hrlich genug beschrieben worden sein,
damit es jeder Interessierte leicht nachvollziehen und vor allem verstehen
kann.
</P>
<P>
Lediglich die Zeilen 7 bis 14 muss ich noch nachreichen. Hierbei handelt es
sich um eine Hilfsfunktion, mit der festgestellt werden soll, ob das
&uuml;bergebene Datum ein Feiertag ist. Bisher beschr&auml;nkt sich die Funktion
allerdings darauf, den Sonntag zu erkennen. Dazu wird in Zeile 10 das Datum
in einen Timestamp konvertiert und mittels der Date-Funktion der Wochentag
ermittelt. Liefert diese 0 zur&uuml;ck, ist es ein Sonntag, und es wird als
R&uuml;ckgabe &quot;red&quot; geliefert, ansonsten &quot;black&quot;. Dieser String wird direkt als
Farbkodierung f&uuml;r die HTML-Font-Anweisung verwendet.
</P>
<H3>* Fortsetzung erw&uuml;nscht?</H3>
<P>
Wenn seitens der Leser Interesse besteht, bin ich gerne bereit, dieses
Beispiel weiter auszubauen und in Verbindung mit einer mySQL-Datenbank mit
dynamischen Inhalten zu erg&auml;nzen, beispielsweise f&uuml;r einen Terminkalender.
Schreibt uns, was euch interessiert!
</P>
<P><B>Michael Christoph &lt;<A HREF="mailto:michael@meicky-soft.de">michael@meicky-soft.de</A>&gt;</B></P>
<P ALIGN="RIGHT">
<A HREF="Workshops1.html"><IMG SRC="../menu/pfeil_links.png" BORDER="0" WIDTH="20" HEIGHT="20" ALT="&lt;&lt;"></A>
 <A HREF="Workshops3.html"><IMG SRC="../menu/pfeil_rechts.png" BORDER="0" WIDTH="20" HEIGHT="20" ALT="&gt;&gt;"></A>
</P>
</BODY>
</HTML>
