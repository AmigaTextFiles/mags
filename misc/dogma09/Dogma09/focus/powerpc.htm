<HTML>
<HEAD>
<TITLE>
Догма - электронное Амижное издание
</TITLE>
<meta http-equiv="content-type" content="text/html; charset=windows-1251">
<BODY BACKGROUND="../gfx/fon.jpg" TEXT="white" bgcolor="black">
</HEAD>
<script language="JavaScript" src="../top.js"></script>

<table align="center" width="90%" border="0">
<tr>
<td colspan="3"><font color="white">
<CENTER><BR><font size="+1" color="yellow"><b>Архитектура процессоров PowerPC</b></font><BR>
<font color="white">Автор -=\<font color="yellow">amif1team</font>/=-</font><HR></CENTER>

<font color="yellow"><b>Архитектура процессоров</b>
<BR><BR>
Особенности RISC-архитектур:</font>
<UL>
<LI>Система команд разрабатывается так, что отдельная команда выполняется за малое число тактов (в идеале за один такт).
<LI>Выполнение команд реализуется аппаратно, а не микропрограммно.
<LI>Для упрощения логики декодирования  используются команды фиксированной длины и фиксированного формата
<LI>Имеется большое количество регистров общего назначения, что позволяет дольше хранить значения переменных внутри процессора без перезагрузки их из памяти
<LI>Используется суперскалярная обработка, позволяющая разбить выполняющуюся команду на этапы и выполнять эти этапы в разных блоках: когда некоторый блок  заканчивает выполнение этапа команды, она переходит в следующий блок, а этот блок начинает выполнение соответствующего ему этапа следующей команды. Как следствие за такт выполняется более 1 команды.
</UL>
<font color="yellow">Расширенные сведения о RISC-архитектурах</font>
<BR><BR>
Основой архитектуры современных  рабочих  станций  и серверов является архитектура компьютера с  сокращенным набором  команд (RISC - Reduced Instruction  Set Computer). Однако  окончательно понятие RISC в современном его понимании сформировалось на базе трех  исследовательских  проектов компьютеров: процессора 801 компании IBM, процессора RISC университета Беркли и процессора MIPS  Стенфордского университета.<BR><BR>
 - В 1980 году Д.Паттерсон со своими  коллегами  из  Беркли  начали свой проект и изготовили две машины, которые  получи ли названия RISC-I и RISC-II. Главными  идеями  этих машин было отделение медленной памяти  от  высокоскоростных регистров и  использование регистровых окон. В 1981 году Дж.Хеннесси со своими коллегами опубликовал описание стенфордской машины MIPS,
основным аспектом разработки которой была  эффективная  реализация конвейерной обработки посредством тщательного  планирования компилятором его  загрузки. Эти  три  машины имели много  общего.  Все они придерживались архитектуры, отделяющей  команды обработки от команд работы с памятью, и делали упор на  эффективную конвейерную обработку.<BR><BR>
Для обработки, как  правило,  используются  трехадресные команды, что помимо упрощения дешифрации дает возможность сохранять большее число переменных в регистрах без их последующей перезагрузки. Ко времени  завершения университетских проектов (1983-1984 гг.)  обозначился также прорыв в технологии  изготовления  сверх больших интегральных схем.
Простота архитектуры и ее эффективность, подтвержденная этими  проектами,  вызвали большой интерес в  компьютерной  индустрии  и с 1986 года началась активная  промышленная реализация архитектуры RISC. К настоящему времени  эта  архитектура прочно занимает лидирующие позиции  на  мировом компьютерном рынке рабочих станций и серверов.<BR><BR>
Развитие  архитектуры  RISC  в  значительной степени определялось прогрессом в области создания  оптимизирующих компиляторов. Именно современная техника  компиляции позволяет эффективно использовать преимущества большего регистрового файла, конвейерной организации и большей скорости выполнения команд.
Современные компиляторы используют также  преимущества другой оптимизационной техники для повышения  производительности, обычно  применяемой  в  процессорах RISC: реализацию задержанных переходов и суперскалярной обработки, позволяющей в один и  тот  же  момент времени выдавать на выполнение несколько команд.<BR><BR>
Следует отметить, что в последних разработках  компании Intel (имеются  в  виду  Pentium и Pentium Pro), а  также  ее  последователей - конкурентов (AMD R5, Cyrix M1, NexGen Nx586 и  др.)  широко  используются идеи, реализованные в RISC-микропроцессорах, так что многие различия между CISC и RISC стираются.
<BR><BR><font color="yellow">
Особенности CISC архитектуры</font><UL>
<LI>Небольшое число регистров.
<LI>Большое количество машинных команд, некоторые из которых нагружены семантически аналогично операторам высокоуровневых языков программирования.
<LI>Команды выполняются за много тактов.
<LI>Большое количество методов адресации.
<LI>Большое количество форматов команд различной разрядности.
<LI>Преобладание двухадресного формата команд
<LI>Наличие команд обработки типа регистр-память
</UL>
<font color="yellow">Дополнительные сведения</font><BR><BR>
Основоположником CISC-архитектуры можно считать компанию IBM с ее базовой архитектурой /360, ядро которой используется с 1964 года и дошло до наших дней, например,  в таких современных мейнфреймах как IBM ES/9000.
Лидером в разработке микропроцессоров c полным набором команд (CISC - Complete Instruction Set Computer) считается компания Intel со своей серией x86 и Pentium.
<BR><BR><font color="yellow">
<b>Архитектура Power</b><BR><BR>
Особенности архитектуры POWER</font><UL>
<LI>Архитектурой набора команд определяется независимый набор регистров для каждого из исполняющих устройств.
<LI>Определены команды "групповой загрузки и записи", которыми обеспечивается возможность пересылки нескольких регистров в/из памяти с помощью единственной команды.
<LI>Возможна модификация базового регистра вновь вычисленным эффективным адресом при выполнении операций загрузки или записи (аналог автоинкрементной адресации)
<LI>Отсутствует механизм "задержанных переходов", когда команды, следующие за условным переходом, выполнялись независимо от истинности условия. Этот механизм неэффективен при суперскалярной обработке. Вместо него используется предварительный поиск условных переходов и "свертка ветвлений" - для предсказанных ветвей замещение команды перехода последовательностью команд, на которую должен был быть переход (команда перехода не выполняется).
<LI>Расширенный регистр флагов:<OL>
<LI>Наличие специального бита влияния на флаги в коде операции каждой команды, что делает модификацию регистра условий дополнительной возможностью, и тем самым позволяет  компилятора реорганизовать код
<LI>Несколько регистров условий для того, чтобы обойти проблему единственного ресурса и обеспечить большее число имен регистра условий так, что компилятор может разместить и распределить ресурсы регистра условий, также как и универсальных регистров.
</OL></UL>
<font color="yellow">Расширенные сведения об архитектуре POWER</font>
<BR><BR>
Архитектура POWER во многих отношениях представляет собой традиционную RISC-архитектуру. Она придерживается наиболее важных отличительных особенностей RISC: фиксированной длины команд, архитектуры регистр-регистр, простых способов адресации, простых (не требующих интерпретации) команд, большого регистрового файла и трехоперандного (неразрушительного) формата команд.
Однако архитектура POWER имеет также несколько дополнительных свойств, которые отличают ее от других RISC-архитектур. Во-первых, набор команд был основан на идее суперскалярной обработки. В базовой архитектуре команды распределяются по трем независимым исполнительным устройствам: устройству переходов, устройству с фиксированной точкой и устройству с плавающей точкой.
Команды могут направляться в каждое из этих устройств одновременно, где они могут выполняться одновременно и заканчиваться не в порядке поступления. Для увеличения уровня параллелизма, который может быть достигнут на практике, архитектура набора команд определяет для каждого из устройств независимый набор регистров. Это минимизирует связи и синхронизацию,
требуемые между устройствами, позволяя тем самым исполнительным устройствам настраиваться на динамическую смесь команд. Любая связь по данным, требующаяся между устройствами, должна анализироваться компилятором, который может ее эффективно спланировать. Следует отметить, что это только концептуальная модель.
Любой конкретный процессор с архитектурой POWER может рассматривать любое из концептуальных устройств как множество исполнительных устройств для поддержки дополнительного параллелизма команд. Но существование модели приводит к согласованной разработке набора команд, который естественно поддерживает степень параллелизма, по крайней мере, равную трем.
Во-вторых, архитектура POWER расширена несколькими "смешанными" командами для сокращения времен выполнения. Возможно единственным недостатком технологии RISC по сравнению с CISC, является то, что иногда она использует большее количество команд для выполнения одного и того же задания. Было обнаружено, что во многих случаях увеличения размера кода можно избежать путем небольшого расширения набора команд,
которое вовсе не означает возврат к сложным командам, подобным командам CISC. Например, значительная часть увеличения программного кода была обнаружена в кодах пролога и эпилога, связанных с сохранением и восстановлением регистров во время вызова процедуры. Чтобы устранить этот фактор IBM ввела команды "групповой загрузки и записи", которые обеспечивают пересылку нескольких регистров в/из памяти с помощью единственной команды.
Соглашения о связях, используемые компиляторами POWER, рассматривают задачи планирования, разделяемые библиотеки и динамическое связывание как простой, единый механизм. Это было сделано с помощью косвенной адресации посредством таблицы содержания (TOC - Table Of Contents), которая модифицируется во время загрузки. Команды групповой загрузки и записи были важным элементом этих соглашений о связях.
Другим примером смешанных команд является возможность модификации базового регистра вновь вычисленным эффективным адресом при выполнении операций загрузки или записи (аналог автоинкрементной адресации). Эти команды устраняют необходимость выполнения дополнительных команд сложения, которые в противном случае потребовались бы для инкрементирования индекса при обращениях к массивам.
Хотя это смешанная операция, она не мешает работе традиционного RISC-конвейера, поскольку модифицированный адрес уже вычислен и порт записи регистрового файла во время ожидания операции с памятью свободен. Архитектура POWER обеспечивает также несколько других способов сокращения времени выполнения команд такие как: обширный набор команд для манипуляции битовыми полями, смешанные команды умножения-сложения с плавающей точкой,
установку регистра условий в качестве побочного эффекта нормального выполнения команды и команды загрузки и записи строк (которые работают с произвольно выровненными строками байтов). Третьим фактором, который отличает архитектуру POWER от многих других RISC-архитектур, является отсутствие механизма "задержанных переходов". Обычно этот механизм обеспечивает выполнение команды, следующей за командой условного перехода,
перед выполнением самого перехода. Этот механизм эффективно работал в ранних RISC-машинах для заполнения "пузыря", появляющегося при оценке условий для выбора направления перехода и выборки нового потока команд. Однако в более продвинутых, суперскалярных машинах, этот механизм может оказаться неэффективным, поскольку один такт задержки команды перехода может привести к появлению нескольких "пузырей",
которые не могут быть покрыты с помощью одного архитектурного слота задержки. Почти все такие машины, чтобы устранить влияние этих "пузырей", вынуждены вводить дополнительное оборудование (например, кэш-память адресов переходов). В таких машинах механизм задержанных переходов становится не только мало эффективным, но и привносит значительную сложность в логику обработки последовательности команд.
Вместо этого архитектура переходов POWER была организована для поддержки методики "предварительного просмотра условных переходов" (branch-lockahead) и методики "свертывания переходов" (branch-folding). Методика реализации условных переходов, используемая в архитектуре POWER, является четвертым уникальным свойством по сравнению с другими RISC-процессорами. Архитектура POWER определяет расширенные свойства регистра условий.
Проблема архитектур с традиционным регистром условий заключается в том, что установка битов условий как побочного эффекта выполнения команды, ставит серьезные ограничения на возможность компилятора изменить порядок следования команд. Кроме того, регистр условий представляет собой единственный архитектурный ресурс, создающий серьезное узкое горло в машине,
которая параллельно выполняет несколько команд или выполняет команды не в порядке их появления в программе. Некоторые RISC-архитектуры обходят эту проблему путем полного исключения из своего состава регистра условий и требуют установки кода условий с помощью команд сравнения в универсальный регистр, либо путем включения операции сравнения в саму команду перехода. Последний подход потенциально перегружает конвейер команд при выполнении перехода.
Поэтому архитектура POWER вместо того, чтобы исправлять проблемы, связанные с традиционным подходом к регистру условий, предлагает: a) наличие специального бита в коде операции каждой команды, что делает модификацию регистра условий дополнительной возможностью, и тем самым восстанавливает способность компилятора реорганизовать код, и b) несколько (восемь) регистров условий для того,
чтобы обойти проблему единственного ресурса и обеспечить большее число имен регистра условий так, что компилятор может разместить и распределить ресурсы регистра условий, как он это делает для универсальных регистров. Другой причиной выбора модели расширенного регистра условий является то, что она согласуется с организацией машины в виде независимых исполнительных устройств. Концептуально регистр условий является локальным по отношению к устройству переходов.
Следовательно, для оценки направления выполнения условного перехода не обязательно обращаться к универсальному регистровому файлу (который является локальным для устройства с фиксированной точкой). Для той степени, с которой компилятор может заранее спланировать модификацию кода условия (и/или загрузить заранее регистры адреса перехода), аппаратура может заранее просмотреть и свернуть условные переходы, выделяя их из потока команд.
Это позволяет освободить в конвейере временной слот (такт) выдачи команды, обычно занятый командой перехода, и дает возможность диспетчеру команд создавать непрерывный линейный поток команд для вычислительных исполнительных устройств. Архитектура POWER включает раздельную кэш-память команд и данных (за исключением рабочих станций и серверов рабочих групп начального уровня, которые имеют однокристальную реализацию процессора POWER и общую кэш-память команд и данных),
64- или 128-битовую шину памяти и 52-битовый виртуальный адрес. Она также имеет интегрированный процессор плавающей точки и таким образом хорошо подходит для приложений с интенсивными вычислениями, типичными для технической среды.
<BR><BR><font color="yellow">
Особенности архитектуры PowerPC</font><UL>
<LI>Однокристальная реализация архитектуры POWER
<LI>Сохранение совместимости с RS/6000 по выполняемому коду
<LI>Упрощение архитектуры с целью ее приспособления ее для реализации дешевых однокристальных процессоров.
<LI>Устранение команд, препятствующих повышению тактовой частоты.
<LI>Устранение архитектурных препятствий суперскалярной обработке и внеочередному выполнению команд.
<LI>Поддержка симметричной многопроцессорной обработки.
<LI>Возможность программной эмуляции тех команд архитектуры POWER, которые не соответствуют требованиям PowerPC
</UL>
<font color="yellow">Расширенные сведения об архитектуре PowerPC</font><BR><BR>
Компания IBM распространяет влияние архитектуры POWER в направлении малых систем с помощью платформы PowerPC. Архитектура POWER в этой форме может обеспечивать уровень производительности и масштабируемость, превышающие возможности современных персональных компьютеров. PowerPC базируется на платформе RS/6000 в дешевой конфигурации. В архитектурном плане основные отличия этих двух разработок заключаются лишь в том,
что системы PowerPC используют однокристальную реализацию архитектуры POWER, изготавливаемую компанией Motorola, в то время как большинство систем RS/6000 используют многокристальную реализацию. Имеется несколько вариаций процессора PowerPC, обеспечивающих потребности портативных изделий и настольных рабочих станций, но это не исключает возможность применения этих процессоров в больших системах.
Первым на рынке был объявлен процессор 601, предназначенный для использования в настольных рабочих станциях компаний IBM и Apple. За ним последовали кристаллы 603 для портативных и настольных систем начально о уровня и 604 для высокопроизводительных настольных систем. Наконец, процессор 620 разработан специально для серверных конфигураций и ожидается, что со своей 64-битовой организацией он обеспечит исключительно
высокий уровень производительности. При разработке архитектуры PowerPC для удовлетворения потребностей трех различных компаний (Apple, IBM и Motorola) при сохранении совместимости с RS/6000, в архитектуре POWER было сделано несколько изменений в следующих направлениях: упрощение архитектуры с целью ее приспособления ее для реализации дешевых однокристальных процессоров; устранение команд, которые могут стать препятствием
повышения тактовой частоты; устранение архитектурных препятствий суперскалярной обработке и внеочередному выполнению команд; добавление свойств, необходимых для поддержки симметричной многопроцессорной обработки; добавление новых свойств, считающихся необходимыми для будущих прикладных программ; ясное определение линии раздела между "архитектурой" и "реализацией"; обеспечение длительного времени жизни архитектуры путем ее расширения до 64-битовой.
Архитектура PowerPC поддерживает ту же самую базовую модель программирования и назначение кодов операций команд, что и архитектура POWER. В тех местах, где были сделаны изменения, которые могли потенциально препятствовать процессорам PowerPC выполнять существующие двоичные коды RS/6000, были расставлены "ловушки", обеспечивающие прерывание и эмуляцию с помощью программного обеспечения. Такие изменения вводились, естественно, только в тех случаях,
если соответствующая возможность либо использовалась не очень часто в кодах прикладных программ, либо была изолирована в библиотечных программах, которые можно просто заменить.
<BR><BR><font color="yellow">
Общие сведения</font><OL>

<LI>Процессор PowerPC 750 - это суперскалярный микропроцессор.<UL>
<LI>до четырех инструкций может быть получено из КЭШа команд за такт.
<LI>до двух инструкций может быть распределено по блокам выполнения за такт.
<LI>до шести инструкций может выполнятся одновременно, включая две целочисленные команды.
<LI>одно-тактовое выполнение большинства команд.</UL>
<LI>Шесть независимых блоков выполнения и два блока регистров.<UL>
<LI>Блок предсказания ветвлений обеспечивает динамическое и статическое предсказание.
<LI>Два целочисленных блока, которые используют 32 РОН для целочисленных операндов.
<LI>Первый целочисленный блок может выполнять любую целочисленную операцию.
<LI>Второй целочисленный блок может выполнять только сложение и вычитание. Большинство инструкций, которые выполняются, занимают один такт. Этот блок имеет схему кэширования операндов.
<LI>Трехступенчатый блок вещественных вычислений.
<LI>Полностью совместимый со стандартом IEEE 754-1985.
<LI>Поддерживает нестандартные режимы для операций, чувствительных к времени выполнения.
<LI>Аппаратная поддержка ненормализованных чисел.
<LI>одноместная схема кэширования операндов.
<LI>32 64-битных регистра для вещественных чисел.
<LI>Двухступенчатый блок загрузки/сохранения.
<LI>Двухместная схема кэширования операндов.
<LI>однотактный, конвейеризованный доступ к КЭШу.
<LI>Специализированный сумматор обеспечивает вычисление эффективного адреса.
<LI>Обеспечивает выравнивание и преобразование точности для вещественных данных.
<LI>Обеспечивает выравнивание и расширение знака для целочисленных данных.
<LI>Трехместная очередь на запись.
<LI>Блок системных регистров обрабатывает различные инструкции.
<LI>Выполняет логические команды над регистром флагов и команды записи / чтения специальных регистров.
<LI>Одноместная схема кэширования операндов.
<LI>Буферы переименования.
<LI>шесть буферов переименования РОН.
<LI>шесть буферов переименования регистров вещественных данных.
<LI>Буферизация регистра флагов обеспечивает две операции чтения/записи за такт.
<LI>Блок завершения.
<LI>Блок завершения выбирает команды из очереди завершения и выстраивает их в порядке появления в программе.
<LI>Гарантируется последовательное выполнение исключений.
<LI>Отслеживание всех распределенных по блокам команд и выстраивание их в порядке выполнения.
<LI>Обнаружение неподтвержденных ветвлений и сброс результатов выполненных команд из неверных ветвей.
<LI>Завершение двух инструкций за такт.
<LI>Раздельный внутикристальный КЭШ для команд и данных (Гарвардская архитектура).
<LI>По 32-килобайта для команд и данных.
<LI>КЭШ можно запрещать программно.
<LI>КЭШ команд обеспечивает выдачу 4-х команд за такт.
<LI>КЭШ данных обеспечивает выдачу двух слов за такт.
<LI>Раздельные блоки управления памятью для команд и данных.
<LI>52-битный виртуальный адрес, 32-битный физический адрес.
<LI>Трансляция адресов для 4-килобайтных страниц.
<LI>Блоки изменяющегося размера, сегменты до 256Мб.
<LI>Управление питанием и контроль температуры.
<LI>Существует 3 статических режима энергосбережения.
<LI>Обеспечивается програмно-контролируемое управление температурным блоком.
<LI>Монитор производительности может быть использован при отладке системы и для увеличения эффективности программного обеспечения.
<LI>Встроенные возможности аппаратного тестирования.
</UL></OL>
<font color="yellow"><b>Основные блоки</b><BR><BR>
Блок обработки команд</font>

<p align="center"><IMG SRC="../gfx/powerpc/1.gif" border="0" alt="Блок обработки команд"></p>

Этот блок отвечает за выборку команд из памяти, обработку команд ветвления, распределение команд по блокам выполнения.
<BR><BR>
<font color="yellow">Блок регистров общего назначения</font>

<p align="CENTER"><IMG SRC="../gfx/powerpc/3.gif" border="0" alt="Блок регистров общего назначения"></p>

Блок регистров общего назначения содержит целочисленные и вещественные РОН, предназначенные для хранения промежуточных или часто используемых данных.
<BR><BR>
<font color="yellow">Блок выполнения</font>

<p align="CENTER"><IMG SRC="../gfx/powerpc/2.gif" border="0" alt="Блок выполнения"></p>

Блок выполнения предназначен для исполнения команд, переданных сюда из блока обработки. Блок состоит из двух подблоков целочисленных вычислений, подблока вещественных вычислений и блока загрузки/сохранения, работающего с ЗУ.
<BR><BR>
<font color="yellow">Блок завершения</font>

<p align="CENTER"><IMG SRC="../gfx/powerpc/5.gif" border="0" alt="Блок завершения"></p>

Блок завершения обеспечивает вступление в силу результатов команды, прошедшей подтверждение и выстраивает выполненные команды в порядке следования их в программе.
<BR><BR>
<font color="yellow">КЭШи 1-ог уровня</font>

<p align="CENTER"><IMG SRC="../gfx/powerpc/4.gif" border="0" alt="КЭШи 1-ог уровня"></p>

Блок КЭШей первого уровня состоит из раздельных КЭШей команд и данных, которые используются для хранения часто используемых ячеек ОЗУ для быстрого доступа к ним.
<BR><BR>
<font color="yellow">Интерфейс КЭШа 2-го уровня</font>

<p align="CENTER"><IMG SRC="../gfx/powerpc/7.gif" border="0" alt="Интерфейс КЭШа 2-го уровня"></p>

Блок интерфейса КЭШа второго уровня используется для сопряжения процессора со схемой КЭШа второго уровня и содержит линии передачи адреса, данных и некоторых управляющих сигналов. Регистр управления используется для установки режима работы.
<BR><BR>
<font color="yellow">Интерфейс шины старых моделей процессоров</font>

<p align="CENTER"><IMG SRC="../gfx/powerpc/6.gif" border="0" alt="Интерфейс шины старых моделей процессоров"></p>

Интерфейс шины старых моделей процессоров используется для обеспечения работы процессора с уже созданными внешними устройствами.
<BR><BR>
<font color="yellow">Полная структурная схема</font>

<p align="CENTER"><IMG SRC="../gfx/powerpc/chem1.gif" border="0" width="800" height="600" alt="Полная структурная схема"></p>

<font color="yellow"><b>Регистры</b><BR><BR>

Особенности регистров PowerPC 750</font><UL>
<LI>Все регистры, за некоторыми исключениями (вещественные РОН и регистр времени 64-разрядные), 32-разрядные.
<LI>Два уровня доступа: пользовательский и системный. Есть регистры доступ к которым для программ пользовательского уровня запрещен.
<LI>Имеются регистры монитора производительности, позволяющие следить за эффективностью использования процессора.
<LI>Имеются регистры управления энергосбережением и температурным режимом.
<LI>Встроенный регистр времени.
<LI>Регистры управления КЭШем.</UL>

<font color="yellow">Дополнительные сведения</font><BR><BR>
Архитектура PowerPC  определяет операции копирования регистр-регистр для большинства вычислительных команд. Операнды команд получаются из регистров, либо из кодов команд. Трех регистровый формат команд позволяет задавать регистр результата и брать операнды из двух других регистров. Команды загрузки/сохранения пересылают данные между памятью и регистрами.<BR><BR>
<font color="yellow">Процессоры PowerPC имеют два уровня привилегий:</font><OL>
<LI>Системный - уровень операционной системы.
<LI>Пользовательский - уровень обычных приложений.
</OL>
Программная модель включает в себя 32 РОН, 32 вещественных регистра, регистры специального назначения и некоторые другие регистры. Каждый PowerPC процессор имеет специфические, зависящие от модели, регистры. Доступ к привилегированным командам, регистрам и др. ресурсам позволяет операционной системе
управлять окружением приложений(обеспечение виртуальной памяти, защита операционной системы и критических ресурсов). Команды, которые управляют состоянием процессора, механизмом трансляции адресов и регистрами уровня операционной системы могут быть выполнены только программой системного уровня.
<BR><BR>
<font color="yellow">Процессор PowerPC 750 обеспечивает следующие регистры:</font><OL>
<LI>CR - пользовательский уровень - регистр флагов состоит из восьми 4 битных полей, отражающих результаты таких операций как перемещение, целочисленное и вещественное сравнение, арифметические и логические команды. Регистр флагов используется при проверке условий и в командах перехода.
<LI>32 FPR - пользовательский уровень - 32 вещественных регистра используются как источники данных и места для записи результатов вещественных команд. Эти 64 битные регистры могут хранить значение как одинарной, так и двойной точности.
<LI>FPSCR - пользовательский уровень - Регистр управления блоком вещественных вычислений хранит сигнальные биты исключений при работе с вещественными числами, биты разрешения этих исключений и некоторые другие биты, необходимые для соответствия стандарту IEEE-754
<LI>32 GPR - пользовательский уровень - РОНы обслуживают блоки целочисленных вычислений
<LI>MSR - системный уровень - Регистр состояния процессора определяет его состояние. Его содержимое сохраняется, если генерируется исключение, и восстанавливается при завершении обработки исключений. В 750 процессоре бит POW этого регистра используется для разрешения управления питанием. Бит PM используется при задании процесса для монитора производительности
<LI>SR0-SR15 - системный уровень - 16 32-битных сегментных регистра определяют 4Гб адресное пространство, как 16 256-мегабайтных сегмента.<BR>
750 реализует сегментные регистры как два массива:<UL>
<LI>главный массив для доступа к данным 
<LI>теневой массив для доступа к кодам инструкций</UL></OL>
Загрузка сегментного регистра с помощью команды MSTR загружает оба массива.
<BR><BR>
Регистры специального назначения решают множество задач: обеспечение контроля, индикации состояния, конфигурирование процессора и других специальных задач. При нормальном исполнении программа получает доступ к этим регистрам на основании ее привилегии доступа, что определяется битом PR в регистре MSR.
Обращение к GPR или FPR осуществляется через операнды, которые являются частями команды. Доступ к регистрам специального назначения может осуществляться как с помощью отдельных команд, так и при выполнении некоторых других инструкций. Доступ к некоторым регистрам осуществляется как первым, так и вторым способом.<BR><BR>
<font color="yellow">В процессоре PowerPC 750 все SPR регистры 32-разрядные.</font><OL>
<LI>LR - пользовательский уровень - Регистр ссылки может быть использован для обеспечения адреса инструкции, на которую производится переход и для сохранения адреса возврата после команд ветвлений и ссылки.
<LI>16 BAT - системный уровень - архитектура определяет 16 регистров трансляции адресов блоков, которые работают в парах. 4 пары используются для блоков данных и 4 пары для блоков ссылки и для блоков команд. Эти регистры используются для определения и конфигурирования блоков памяти.
<LI>CTR - пользовательский уровень - Счетчик команд.
<LI>DABR - системный уровень -  Определяет точку останова по данным.
<LI>DAR - пользовательский уровень - Регистр адреса данных, сохраняет адрес доступа после выравнивания или исключения DSI
<LI>DEC - системный уровень - Регистр декремента - это 32-битный уменьшающий счетчик, который обеспечивает выполнение исключений декрементирующего устройства.
<LI>DSISR - пользовательский уровень - Определяет случаи доступа к данным и исключений выравнивания.
<LI>EAR - системный уровень - Регистр внешнего доступа. Управляет доступом к блоку внешних устройств с помощью команд ECIWX и ECOWX.
<LI>PVR - системный уровень - Регистр версии процессора. Доступен только для чтения. Хранит идентификатор процессора.
<LI>SDR1 - системный уровень - Этот регистр задает формат таблицы страниц, используемой при трансляции адресов страниц виртуальной памяти
    в адреса страниц физической памяти.
<LI>SRR0 - системный уровень - Регистр сохранения состояния процессора. Используется для перезапуска первой программы, когда выполняется RFI (возврат из прерывания)
<LI>SRR1 - системный уровень - Регистр сохранения состояния процессора. Используется для сохранения состояния процессора при возникновении исключений.
<LI>SPRG0-SPRG3 - системный уровень - Используется операционной системой.
<LI>TB - пользовательский уровень "чтение", системный "чтение/запись" - 64-разрядный регистр времени. Хранит текущее время и управляет интервальными таймерами.
<LI>XER - пользовательский уровень - содержит общий бит переполнения, целочисленный бит переноса и поле, указывающее количество байт, которые должны быть переданы с помощью команд LSWX и STSWX.
</OL>
<font color="yellow">Специфические регистры процессора PowerPC 750.</font><OL>
<LI>HID0 - системный уровень - Обеспечивает разрешение/запрещение условных точек останова.
<LI>HID1 - системный уровень - Позволяет программному обеспечению считывать сигналы конфигурации оборудования.
<LI>IABR - системный уровень - Регистр точки прерывания по адресу команды. Поддерживает исключения по точкам останова.
   Может содержать адрес для сравнения с адресами команд находящихся в очереди. При равенстве адресов генерируется исключение точки останова.
<LI>ICTС - системный уровень - Регистр содержит состояние КЭШа команд 1го уровня (время, за которое команды загружаются в очередь блока команд).
<LI>L2CR - системный уровень - Регистр управления КЭШем второго уровня. Позволяет конфигурировать КЭШ второго уровня. Имеются разрешения/ запрещения проверки четности
   установки скорости передачи данных и идентификации типа памяти КЭШа второго уровня.
<LI>MMCR0-MMCR1 - системный уровень - Регистры управления режимом монитора производительности. Используются для запрещения/разрешения различных исключений монитора производительности.
   Существуют регистры UMMCR0-UMMCR1, которые обеспечивают доступ для чтения к регистрам MMCR0-MMCR1 для программ пользовательского уровня.
<LI>PMC1-PMC4 - системный уровень - Это счетчики монитора производительности. Используются для подсчета указанных событий. UPMC1-UPMC4 обеспечивают доступ для чтения  программам пользовательского уровня
<LI>SIA - системный уровень - Регистр содержит эффективный адрес команды, которая выполняется в момент, когда процессор сообщает монитору производительности о возникновении условия прерывания. USIA обеспечивает чтение регистра SIA  для программ пользовательского уровня.
<LI>THRM1-THRM2 - системный уровень - Обеспечивают сравнение температуры процессора с двумя заданными уровнями. Блок управления температурой работает только с одним из этих регистров одновременно.
<LI>THRM3 - системный уровень - Используются для разрешения блока контроля температуры и задания интервала, через который будет происходить проверка.
</OL>

<p align="CENTER"><IMG SRC="../gfx/powerpc/prmodel2.gif" border="0" alt=""></p>

<font color="yellow">Исключения</font>
<UL>
<LI>Механизм исключений PowerPC позволяет прерывать исполняющуюся программу, чтобы обрабатывать ситуации, вызываемые внешними сигналами и необычными условиями выполнения программы. Когда возникает исключение, информация о состоянии процессора сохраняется
во внутренних регистрах и процессор начинает выполнение программы, адрес которой находится по специальному адресу в памяти (в векторе исключения). Вектор исключения определен для каждого типа исключения. Обработка исключений производится в системном режиме.
<LI>В PowerPC точные исключения обрабатываются в порядке появления, поэтому, если обрабатывается одно исключение и приходит другое, такого же либо более низкого приоритета, то это другое исключение начинает обрабатываться после завершения обработки первого.
<LI>Когда начинается обработка исключений, информация о состоянии процессора сохраняется в SSR0 и SSR1.Обработчики исключений обязаны сохранять информацию, находящуюся в этих регистрах для того, чтобы состояние программы могло быть восстановлено после обработки исключений.
</UL>
<font color="yellow">Архитектура PowerPC поддерживает 4 типа исключений:</font><UL>
<LI>Синхронное точное - Этот тип генерируется командами программ. Все эти исключения гарантированно обрабатываются. Это значит, что адрес команды вызвавшей исключение передается в обработчик и ни одна команда после нее не выполняется до завершения обработки
<LI>Синхронное неточное - Этот тип генерируется программно, но возможно не обрабатывать это исключение. В PowerPC есть два типа неточных исключений при работе с плавающей точкой с восстанавливаемым и невосстанавливаемым состоянием. 750 позволяет   запрещать/разрешать неточные исключения.<BR>
Здесь они реализованы также как и точные (разрешенные вещественные исключения всегда точные).
<LI>Асинхронные маскируемые - Архитектура PowerPC определяет внешние прерывания и прерывания декрементирующего устройства как маскируемые асинхронные исключения.<BR>
Когда появляется одно из этих исключений, завершается выполнение текущей команды и всех исключений связанных с ней. Затем выполняется обработчик исключений.
<LI>Асинхронные немаскируемые - существует два типа асинхронных немаскируемых исключений
<LI>системный сброс
<LI>исключения проверки машины</UL>

Эти исключения могут не обеспечивать восстановление состояния, либо обеспечивать ограниченное восстановление.
<BR><BR>
- Когда появляется исключение, вызванное программно, все, не выполненные команды, появившиеся раньше в потоке инструкций, включая не распределенные по блокам выполнения, завершают свое выполнение перед тем, как исключение будет обработано. Асинхронные исключения запоминаются по приходу, но начинают обрабатываться только тогда, когда опустеет очередь завершения выполнения команд.<BR>
- Если не происходит системного сброса или исключения проверки машины, то одновременно обрабатывается только одно исключение. Например, если одна команда вызывает исключение по нескольким условиям, то эти исключения генерируются последовательно.<BR>
- После того, как обработчик исключений обработает его, выполнение программы продолжается до следующего исключения.<BR>
- Распознавание и обработка условий исключений последовательно гарантирует возвращение в программу после обработки.

<p align="CENTER"><IMG SRC="../gfx/powerpc/esch.gif" border="0" alt="Cхема обработки исключений"></p>

<font color="yellow"><b>Сигналы</b><BR><BR>
Группы сигналов</font><UL>
<LI>Группа адресных сигналов
<LI>Подгруппа арбитража адреса<BR>
Сигналы арбитража адреса - это входные и выходные сигналы, которые используются для создания запросов процессору на захват шины, выяснения момента освобождения шины и сигнализации того, что управление шиной адреса передается внешнему устройству.
<LI>Подгруппа начала передачи<BR>
Сигнал начала передачи показывает, что началась передача адреса по шине. Этот сигнал обозначает начало операции доступа к памяти.
<LI>Адресная шина<BR>
Эти сигналы используются для приема/передачи адреса и контроля четности
<LI>Атрибуты передачи<BR>
Это набор сигналов, характеризующий текущую передачу (размер передачи, направление передачи, и то полностью ли заполняется Кэш или частично).
<LI>Завершение передачи адреса<BR>
Эти сигналы указывают, что фаза передачи адреса успешно завершена, либо требуется повторение и характеризуют момент, когда передача должна быть завершена.
</UL>
<UL>
<LI>Группа сигналов данных
<LI>Подгруппа арбитража данных<BR>
Также как и подгруппа арбитража адреса, эта группа указывает моменты захвата шины.
<LI>Шина данных<BR>
Шина данных состоит из 64-х линий передачи данных и нескольких линий передачи четности используются для передачи данных из / в внешнего устройства.
<LI>Завершение передачи данных<BR>
Сигналы этой группы используются после каждого такта передачи данных своими активными уровнями сигнализируют о том, что в текущем такте передача данных завершена
</UL>
<UL>
<LI>Группа сигналов управления
<LI>Подгруппа сигналов прерываний и сбросов<BR>
Большинство из этих сигналов  - входные. По этим линиям приходят сигналы исключений и сбросов процессора. Немногочисленные выходные сигналы сигнализируют внешним устройствам о том что процессор достиг точки останова
<LI>Подгруппа сигналов управления процессором<BR>
Эта группа обеспечивает выдачу внешним устройствам состояние процессора и установки режимов его работы, таких как режим работы таймера.
<LI>Подгруппа сигналов тактирования<BR>
Сигналы тактирования - это входные сигналы, которые определяют частоту системного  тактового генератора и обеспечивают гибкую схему управления умножителем частоты
</UL>
<UL>
<LI>Группа сигналов тестового интерфейса<BR>
Сигналы тестового интерфейса используются для управления специализированным тестовым контроллером и обеспечивают управление передачей кодов инструкций в этот контроллер.
<LI>Сигналы управления КЭШем второго уровнем.<BR>
Эта группа состоит из специализированной шины данных,  шины адреса и сигналов управления КЭШем второго уровня. Эта группа используется для приема/передачи данных из КЭШа второго уровня.
</UL>

<p align="CENTER"><IMG SRC="../gfx/powerpc/signals1.gif" border="0" alt="Cтруктурная схема"></p>

<font color="yellow"><b>Система команд</b></font><BR><BR>

Архитектура PowerPC использует команды, имеющие 4-байтовую длину и выровненные по границе слова.
Это обеспечивает для байтовых, полусловных, и словных операндов более быструю пересылку между РОНами и памятью.
Это также обеспечивает более быструю пересылку вещественных операндов.
<BR><BR>
Все команды PowerPC закодированы в однословные (32-битные) коды операций. Форматы команд выбраны так, чтобы обеспечивать эффективное декодирование параллельно с доступом к операндам
Фиксированная длина команды и постоянный формат очень упрощают распараллеливание выполнения.
<BR><BR>
<font color="yellow">Формат команды PowerPC:</font>

<table align=center border=1>
<tr><th>0 1 2 3 4 5</td><th> 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31</td></tr>
<tr align=center><td>   КОП     </td><td>дополнительные данные</td></tr>
</table>
<BR>
К дополнительным данным относятся: регистры, с которыми работает команда, бит действия на флаги, код уточнения типа операции, непосредственные операнды.
<BR><BR>
<font color="yellow">Все команды PowerPC  делятся на следующие категории:</font><UL>
<LI>целочисленные команды. Они включают вычислительные и логические команды
<LI>Вещественные команды. Включают вычислительные команды над вещественными операндами и команды, которые оказывают влияние на  регистр FPSCR.
<LI>Команды загрузки/сохранения. Включают в себя команды для загрузки и записи (из/в память) целочисленных и вещественных операндов.
<LI>Команды контроля выполнения. Эти команды включают в  себя команды ветвления и логические команды над регистром флагов, команды лвушек и др. команды, которые могут сказаться на ходе выполнения программы
<LI>Команды управления процессором. Управление исключениями, монитором производительности, энергосбережением.
<LI>Команды управления памятью. Эти команды используются для синхронизации доступа к памяти, управления КЭШами, буферами преобразования адресов и сегментными регистрами.
</UL>
<font color="yellow">Набор команд процессора PowerPC 750</font><UL>
<LI>Обеспечивается аппаратная поддержка всех 32-битных команд архитектуры PowerPC.</UL>
<font color="yellow">Следующие команды реализованы только в процессоре PowerPC 750:</font><UL>
<LI>Команда ввода из внешнего устройства (eciwx)
<LI>Команды вывода во внешнее устройство (ecowx)
<LI>Вещественный выбор (fsel)
<LI>Команда оценки преобразования вещественного в формат с одинарной точностью (fres)
<LI>Команда оценки точности вычисления квадратного корня (frsqrte)
<LI>Сохранение вещественного числа как целочисленного</UL>
<font color="yellow"><b>Примеры команд</b><BR><BR>
Целочисленные команды</font>
<PRE>
                    0-5     6-10 11---15   16 -20     21     22----30     31
divw x   |31  | D   |    A  |  B  |  OE |  491 |  Rc
команда деления А - делимое, D - частное, B - частное
addi     |14  | D   |    A  |       SIMM 
Сумма регистра А и непосредственного операнда SIMM помещается в регистр D

               0 --- 5 6--------- 8  9     10 11-15  16-20 21 - 30   31
cmp    | 31 |  crfD  | 0 |  L |  A |   B |   0b | 0b
Команда сравнения регистр А сравнивается с регистром В как числа со знаком. Результат помещается в поле регистра CR указанное в crfD

                   0------5  6-10  11-15 16-20  21----30     31
eqv x  |  31  | S |  A  |  B |  284  | Rc
С содержимым регистров rS и rB  выполняется операция "исключающее или", результат помещается в регистр rA
andi.   |  28  | S |  A  |     UIMM
C содержимым регистра rS и непосредственным беззнаковым операндом UIMM выполняется операция "побитовое И" и результат записывается в rA

Вещественные команды
                0 -5  6---10 11---15 16-20 21-25 26-30     31
fmadd x | 63 |  D  |   A   |  B  | C  | 29   | Rc
Вещественный операнд в регистре frA умножается на содержимое frС. К результату умножения прибавляется содержимое регистра frB и результат записывается в frD.

               0-------5 6---10 11--------15  16-20  21-30     31
fctiw x    |  63  |  D  | 00000  |  B   | 14   | Rc
Округление rB к меньшему целому. Результат записывается в биты 32-63 frD.

Команды загрузки/сохранения
               0-------5 6---10 11--------15  16 ------------  31
lbz          |  34  |  D  |     A      |         d
Загрузка байта по адресу (rA+d) в младшие 8 бит регистра rD. Остальные биты регистра rD очищаются

                0------5 6---10 11-15  16-20   21-----30   31
stbux      |  31  |  S  |   A  |   B  |  247   | 0
Младшие 8 бит регистра rS записываются в память по адресу (rA+rB).
В rA записывается новый текущий адрес
stfdux     |  31  |  S  |   A  |   B  |  759   | 0
Запись вещественного числа хранящегося в frS по адресу (rA+rB). Новый текущий адрес записывается в rA.

Команды управления  выполнением
                 0---5   6----------------29      30          31
bx            |18  |  LI               |   AA  |  LK
Переход по адресу (текущий+LI)

                      0-----5  6----10  11---15 16-20  21-30   31
tw           |  31 |  TO |   A   |   B  |   4  | 0
Сравнивается содержимое регистров rA и rB. Если результаты сравнения совпадают с полем ТО то генерируется исключение ловушки.

Команды управления процессором
            0-5   6-10 11--------------------20  21--30    31
mfcr   |  31 |  D | 0000000000  |  19  | 0
Содержимое CR помещается в регистр rD

                0----5    6------10 11------20  21--------30      31
mfspr |  31  |    D   |   spr   |   339      | 0
Cодержимое указанного регистра специального назначения ( поле spr) помещается в rD.

Команды управления памятью
                 0---5   6---------10    11-15   16-20   21-30     31
Dcbf  | 31 | 00000  |   A   |  B   |  86  | 0
Выталкивает из КЭШа данных, данные которые хранятся по адресу (rA+rB).

tlbie   | 31 | 0000000000 |  B   | 306 | 0
Удаляет из буферов трансляции адресов информацию об адресе, который хранится по адресу (rB)
</PRE>
<font color="yellow">Обозначения:</font><BR><BR>

A,B,C,D,S - поле регистра общего назначения (в вещественных командах - вещественного)<BR>
OE - бит разрешения переполнения<BR>
SIMM - непосредственный операнд со знаком<BR>
UIMM - непосредственный операнд без знака<BR>
d - непосредственно заданное смещение<BR>
crfD - поле регистра флагов в который будет помещен результат сравнения<BR>
Rc - бит разрешения воздействия на флаги (регистр CR)<BR>
LI - 24-битное смещение в командах передачи управления<BR>
LK - Бит разрешения записи в регистр ссылки. В командах передачи управления при установке этого бита адрес следующей команды записывается в регистр ссылки.<BR>
АА - Поле абсолютного адреса. В командах перехода при установке этого бита адрес перехода вычисляется относительно текущего адреса команды. Если бит сброшен, то поле LI содержит абсолютный адрес, по которому передается управление.

</td></tr>
</table>

<script language="JavaScript" src="../down.js"></script>
</BODY>
</HTML>
