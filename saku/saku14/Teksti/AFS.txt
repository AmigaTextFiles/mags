5
1*

{3                                 Ami-File-Safe
{3                                 -------------

                                 Mat Bettinson

                           Käännös: Antti Vähä-Sipilä


Ami-File-Safe (AFS) on Amigoille tarkoitettu korvaava tiedostojärjestelmä. Se on
kehitetty sharewarena levitetystä Professional File Systemistä (PFS).  Julkaisi-
jana on Forth Level Developments (osoite löytyy artikkelin lopusta). Ohjelmistoa
kehitetään yhteistyössä alkuperäisen tekijän kanssa. AFS on tarkoitettu Fast Fi-
le Systemin (FFS) korvaamiseen sekä kovalevyillä että korpuilla.

AFS vaatii 2.04:n tai uudemman käyttöjärjestelmän, ja  kovalevyasennusta  varten
tarvitaan vielä jokin kelvollinen Prep-ohjelmisto. Asennus onnistuu HDToolboxil-
la, mutta suosittelen RD Prepiä. Itse ohjelmistossa on kopiokohtainen sarjanume-
ro, ja valmistava yritys on tehnyt sopimuksen kansainvälisen turvallisuusyrityk-
sen kanssa piraattien jäljittämisestä. Ohjelmisto on varsin arvokas;  tällä  il-
meisesti  kompensoidaan  näin  käyttökelpoisen  ohjelman  laajaa  piratisointia.
Jälleen kunnon käyttäjät joutuvat maksamaan rahaa piratismin vuoksi.

Ohjelmisto on testattu Amiga 4000:lla, jossa oli Cyberstorm 060 ja  Cybervision,
14 Mt RAM-muistia ja 512 Mt:n Conner IDE. Ohjelma testattiin myös 3640:n kanssa.
Sen lisäksi käytettiin Amiga 3000:ta GVP Spectrumilla, GVP IO Expanderilla, Con-
nerin 540 Mt:n SCSI-levyllä ja 105 Mt:n Quantumilla, käyttöjärjestelmänä OS 3.1.
Low-end-koneista testauksessa oli mukana A1200 varustettuna Apollo 1220  28  MHz
'020-laudalla, 4 Mt:n fast-muistilla ja Seagaten 120 Mt:n kovalevyllä.

Asennus on melko kivutonta Commodoren Installerilla. Koko hoito on oikeastaan 38
kilotavun tiedosto, joka on sijoitettu L:-hakemistoon ja josta on olemassa  sekä
pienempi levykeversio että 68020-optimoitu  versio.  Asennusohjelmassa  valitaan
manuaalisesti CPU:n  tyyppi.  Levykeasennuksessa  mountataan  mountlististä  tai
erillisestä mount-tiedostosta esimerkiksi DOSDriversissä,  ja  asemia  käytetään
osoittamalla niitä esimerkiksi nimellä AF1: ja niin  edelleen.  Kaikilla  testa-
tuilla koneilla levykkeet pystyttiin mounttaamaan sekä normaaleiksi että AFS- ja
PC-levykkeiksi.

Kovalevyasennus on tietenkin hieman monimutkaisempi. Koko levystä tulee  ensiksi
tehdä varmuuskopio. ReOrgista tuttu  Holger  Kruse  on  tehnyt  ohjelman,  jolla
FFS/OFS-levy muutetaan nopeasti AFS:ksi  ilman  varmuuskopiota,  mutta  sitä  ei
vielä ollut saatavissa kirjoittaessani artikkelia. Nyt minun oli vain tyydyttävä
kopioimaan kaikki talteen osiolta. Varsinainen asennus tehdään  Prep-ohjelmalla.
Suosittelemassani RD Prepissä asensin tiedostojärjestelmän "Complex Moden"  file
system -sivulla. DOS-tyyppi vaihdettiin "AFS1":een heksana ja  lähdekooditiedos-
toksi asetettiin "HardDiskAFS".  Osiointisivulla  vaihdoin  tiedostojärjestelmän
AFS:ksi ja nostin puskureita noin 200:aan, jotka AFS tarvitsee sisäänrakennettua
välimuistiaan varten. Siirryin pääsivulle ja tallensin RDB:ni. Hienoa.  Boottaus
tai dismounttaus ja uudelleen mounttaus RD Prepillä tallennetusta mountlististä,
nopea formatointi ja nyt meillä on AFS-osio. Kivutonta.

Olin erittäin innostunut näkemään AFS:n, koska vanhana PFS-käyttäjänä näin siinä
suurenmoisen potentiaalin. PFS vain ei kyennyt aivan siihen mihin olisi pitänyt,
ja se oli hirvittävän buginen (näin on, toim. huom.). AFS:llä ei ollut  ongelmia
asennuksessa suhteellisen suurelle osiolle. Olin käyttänyt LZX:ää osion  pakkaa-
miseen, eikä se kestänyt kauan. (Cyberstormilla lähinnä siksi, että  voin  tehdä
sen.) Asennuksen ja formatoinnin jälkeen avasin tämän mega-arkiston takaisin uu-
delle AFS-levylle. Huh. Avaus osiolle oli uskomattoman nopeaa, mutta en  osannut
tarkalleen sanoa kuinka nopeaa. Tällä laitteistolla jätin asian sikseen joksikin
aikaa. En huomannut ongelmia tai tehonlisäystä, koska en  ollut  vielä  tottunut
Cyberstormiin. Nyt kotiin asentamaan ohjelmisto Amiga 3000:eeni.

Kotona huomasin, kuinka paljon nopeampi AFS todella oli. Hakemistohaut  peittoa-
vat FFS-DC:n mennen tullen. Kirjoittaminen on pelottavan paljon nopeampaa. Levy-
keasennuksessa minun piti tehdä nopeustestit uudelleen, koska en uskonut  niiden
paikkansapitävyyteen. Koska minulla on purkki ja käsittelen paljon  Usenetin  ja
Fidonetin viestejä Mail Manager -tosserilla, kokeilin sitä. Rikoin sen  pahasti.
Mail Manager teki turhia hakuja siellä täällä. Kerroin viasta MM:n tekijälle  ja
Forth Levelille. Muutaman päivän  kuluttua  sain  korjaukset  sekä  MM:ään  että
AFS:ään, ja nyt kokeilin MM:ää uudestaan. Se  oli  mahtavan  nopea!  Toss-nopeus
lisääntyi noin 500 viestistä minuutissa 1200 viestiin. Levyn lukupäiden  liikut-
telukin väheni. Jopa levytilaa jäi enemmän jäljelle. Eihän näin hyvää  ohjelmis-
toa voi ollakaan. Tässä on oltava koira haudattuna. AFS:n tapauksessa koira  on-
kin varsin iso; tällä hetkellä sille ei ole olemassa mitään undelete-  tai  kor-
jausohjelmia. (Dave Haynie tosin lupaa Disksalvin  uuden  version  tukevan  sitä
pian.)

Kuinka turvallinen Ami-File-Safe sitten on? Seuraavan parin päivän  aikana  tein
asioita, jotka saisivat kyynelet silmäkulmiisi. Resetoin koneen sen kirjoittaes-
sa suuria tiedostoja kerta toisensa jälkeen. Odotin, kunnes AFS siirsi välimuis-
tiaan tai BAM/FAT:ia levylle ja kytkin koneesta virrat pois kesken kaiken.  Joka
kerta luulin koneen kaatuvan siihen. AFS-osiosta ei koskaan tule validoimatonta,
joten ihmettelin, miten se huolehtii korruptoituneista levyistä.  Tätä  ongelmaa
ei kuitenkaan tullut, koska levy ei koskaan korruptoitunut! Päätin antaa AFS:lle
tosi haasteen ja tein kauheita asioita: revin SCSI-kaapelin irti kesken  kirjoi-
tuksen (tosin romulla Quantumilla varmuuden vuoksi).  Lopputulos:  ei  ongelmia.
Tämä tiedostojärjestelmä on todella turvallinen. Undeleteä  tosin  jäin  kaipaa-
maan.

AFS tallentaa tiedostoja blokkirajojen yli eikä vaadi yhden blokin minimiä. Tämä
tekee siitä paljon FFS:ää tehokkaamman levytilan käyttäjän. WB:n antamat levyti-
lalukemat ovat tosin usein vääriä. On myös muistettava,  että  tilaa  on  alussa
käytössä vähemmän, koska esimerkiksi hakemistoille varataan  tilaa.  Lopulta  se
tosin peittoaa FFS:n levytilassa, ja info-komento antaa oikeita lukemia.

Vaikka jokin ohjelma käyttäisi paljon tiettyä osiota ja avaisit sen  WB:ssä  tai
muuten samanaikaisesti, lukupäät eivät juoksentele edestakaisin. Nopeus  tieten-
kin hidastuu, mutta siirtyneen tiedon määrä yhteensä eri taskien summana  lienee
hyvin lähellä maksimia. AFS  lupaa  tämän  manuaalissaan,  mutta  sen  näkeminen
käytännössä on mukavaa. FFS:llä on ilmeisesti hakuja  joka  blokin  jälkeen  tai
sinne päin, jolloin monen taskin yhtäaikainen käyttö hidastaa levyä huomattavas-
ti. Useimmat muistavat tämän ilmiön käynnistäessään  validoimattomalta  osiolta.
AFS:llä tätä huolta ei ole.

AFS:lle ei myöskään ole ReOrgia. Se kuulemma  kuuluu  tiedostojärjestelmään  it-
seensä, eikä AFS tällöin fragmentoidu kuten OFS/FFS. En osaa  antaa  varmennusta
tälle. Seuraavassa kuitenkin testituloksia: 

MKSoft DiskSpeed 4.2  Copyright  1989-92 MKSoft Development
------------------------------------------------------------
CPU: 68030  AmigaOS Version: 40.70  Normal Video DMA
Device:  TESTFFS:    Buffers: 200
Comments: FFS Partition

CPU Speed Rating: 1375

Testing directory manipulation speed.
File Create:           55 files/sec  |  CPU Available: 62%
File Open:            294 files/sec  |  CPU Available: 3%
Directory Scan:       409 files/sec  |  CPU Available: 11%
File Delete:          454 files/sec  |  CPU Available: 5%

Seek/Read:            878 seeks/sec  |  CPU Available: 7%

Testing with a 32768 byte, MEMF_FAST, LONG-aligned buffer.
Create file:       227104 bytes/sec  |  CPU Available: 24%
Write to file:      51949 bytes/sec  |  CPU Available: 69%
Read from file:    244537 bytes/sec  |  CPU Available: 19%

Testing with a 65536 byte, MEMF_FAST, LONG-aligned buffer.
Create file:       222155 bytes/sec  |  CPU Available: 26%
Write to file:      51895 bytes/sec  |  CPU Available: 69%
Read from file:    236386 bytes/sec  |  CPU Available: 20%

Testing with a 131072 byte, MEMF_FAST, LONG-aligned buffer.
Create file:       238601 bytes/sec  |  CPU Available: 22%
Write to file:      49742 bytes/sec  |  CPU Available: 70%
Read from file:    244537 bytes/sec  |  CPU Available: 20%

Testing with a 262144 byte, MEMF_FAST, LONG-aligned buffer.
Create file:       235106 bytes/sec  |  CPU Available: 21%
Write to file:      50219 bytes/sec  |  CPU Available: 70%
Read from file:    238312 bytes/sec  |  CPU Available: 20%

Average CPU Available: 32%  |  CPU Availability index: 440

MKSoft DiskSpeed 4.2  Copyright  1989-92 MKSoft Development
------------------------------------------------------------
CPU: 68030  AmigaOS Version: 40.70  Normal Video DMA
Device:  TESTAFS:    Buffers: 200
Comments: AFS Partition

CPU Speed Rating: 1375

Testing directory manipulation speed.
File Create:          169 files/sec  |  CPU Available: 2%
File Open:            292 files/sec  |  CPU Available: 0%
Directory Scan:      1780 files/sec  |  CPU Available: 0%
File Delete:          285 files/sec  |  CPU Available: 0%

Seek/Read:             96 seeks/sec  |  CPU Available: 73%

Testing with a 32768 byte, MEMF_FAST, LONG-aligned buffer.
Create file:      1073152 bytes/sec  |  CPU Available: 1%
Write to file:    1150976 bytes/sec  |  CPU Available: 2%
Read from file:   1363968 bytes/sec  |  CPU Available: 8%

Testing with a 65536 byte, MEMF_FAST, LONG-aligned buffer.
Create file:      1116720 bytes/sec  |  CPU Available: 1%
Write to file:    1209392 bytes/sec  |  CPU Available: 1%
Read from file:   1372823 bytes/sec  |  CPU Available: 12%

Testing with a 131072 byte, MEMF_FAST, LONG-aligned buffer.
Create file:      1146880 bytes/sec  |  CPU Available: 1%
Write to file:    1245184 bytes/sec  |  CPU Available: 0%
Read from file:   1343488 bytes/sec  |  CPU Available: 16%

Testing with a 262144 byte, MEMF_FAST, LONG-aligned buffer.
Create file:       973306 bytes/sec  |  CPU Available: 1%
Write to file:    1259066 bytes/sec  |  CPU Available: 0%
Read from file:   1376256 bytes/sec  |  CPU Available: 16%

Average CPU Available: 8%  |  CPU Availability index: 110

Kuten näette, yksittäisten blokkien haku on hitaampaa ja  käyttää  myös  enemmän
CPU:ta (välimuisti?) kuin FFS, mutta nopeus on paljon suurempi. Raskaasti  frag-
mentoituneilla  FFS-osioilla  tiedostonkäsittely  on  huomattavasti   hitaampaa,
AFS:llä eroa ei huomaa. Ilmeisesti on totta, ettei AFS fragmentoi paljoa.

Yhteensopivuusongelmia ei esiintynyt. Kaikki toimi normaalisti myös  AFS-osioil-
ta, ja systeemin voi laittaa softkickatun A3000:n RDB:hen. Mail Managerin  beta-
versiossa oli bugi, mutta se on nyt korjattu. Koska MM:n DOSin käyttö  on  hyvin
monimutkaista (postin tossailua viestikantoihin  asynkronisella  I/O:lla),  olen
melko varma siitä, että AFS on 100% yhteensopiva muidenkin ohjelmien kanssa. Jos
vikoja on, Forth Level korjaa ne nopeasti.

Ohjelman dokumentointi oli lasertulostettu, lyhyt  ja  perustavanlaatuinen.  Sen
saa nykyään myös saksaksi ja ranskaksi, ja uusi versio  lienee  tulossa.  Olisin
kaivannut lisää teknisiä yksityiskohtia AFS:stä. Ei kovin hyvä vastine  rahalle.
Muuten ohjelma on kyllä mainio. Tunne on kuin lisäisi huippunopean Zorro III SC-
SI-ohjaimen. Levyä kuluu vähemmän, ei raavi lukupäitä. Hyvä asia  niille,  jotka
käyttävät Amigaansa paljon moniajossa.

Ohjelman valmistaja, Forth Level, on erittäin ystävällinen ja mukava yritys. On-
gelmia ratkaistaan  puhelimitse.  He  vastaavat  soittopyyntöihin  (Englannissa,
toim. huom.), lähettävät uusia versioita,  heillä  on  Internet-osoite  ja  niin
edelleen. Olisivatpa kaikki myyjät näin hyviä.

Mielestäni Amiga Technologiesin pitäisi puhua Forth Levelille AFS:stä HETI.

AFS:stä on olemassa kaksi versiota, "Pro" ja "User". User-versiossa on  maksimi-
levykoko 650 Mt ja ainoastaan yksi asema, ei MuFSiä ja lisenssi  koskee  ainoas-
taan yhtä konetta. Levykokorajoitus tarkoittaa todella levykokoa eikä osion  ko-
koa. Tulossa on myös Zip-asemien tuki.

Valmistajan tiedot: 

        Nimi:           Forth Level Developments
        Osoite:         31 Ashley Hill, Montpelier
                        Bristol BS6 5JA
                        United Kingdom

        Puhelin:        990-44-117-985-4455
        Faksi:          990-44-117-955-9157

        Internet:       afssales@flevel.demon.co.uk

AFS:n Pro-versio maksaa 59.36 puntaa, arvonlisäveron voi maksaa joko Englannissa
tai Suomessa. Jos maksat Englannissa, hinta on 69.75 puntaa.

User-versio maksaa 25.32 puntaa, arvonlisäveroineen 29.75 puntaa.

AFS:ää varten on nyt myös Internetin postituslista. Lähetä  viesti  osoitteeseen
emailurl@flevel.demon.co.uk ja laita viestin ensimmäiselle riville SUBSCRIBE AFS
<Internet-osoitteesi>.

(Artikkeli julkaistiin alun perin  Internetin  uutisryhmässä  comp.sys.amiga.re-
views. Se on käännetty ja julkaistu uudelleen alkuperäisen tekijän luvalla.  (C)
1995, Mat Bettinson <mat@darkside.demon.co.uk>) 
