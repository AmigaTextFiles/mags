\T

 --> H.I.D.D.E.N  P.A.R.T
=====================

Traduction francaise de "MorphOS In Detail", r_alis_e par Mehdi "Kal-L" Boulahia.
Copyright (C) novembre 2002 Thendic-France.

~\ Sommaire

1. Introduction
2. Le Pass_ : L'Histoire de MorphOS
3. Le Pr_sent : La Structure de MorphOS
4. Le Pr_sent : L'A-Box
5. Le Futur : La Q-Box
6. Informations Suppl_mentaires

Ce document a _t_ _crit dans l'optique de d_crire MorphOS, comment il a vu le jour,
son fonctionnement, son _tat actuel et les futurs plans. Remerciements sp_ciaux a
Bplan et a l'_quipe de d_veloppeurs de MorphOS pour leur grande assistance.

~\ Introduction

MorphOS est un nouveau syst_me d'exploitation pour microprocesseurs RISC PowerPC,
il fonctionne sur le Pegasos ainsi que sur les cartes PowerUP pour Amiga
(CyberstormPPC et BlizzardPPC). Il a aussi _t_ test_ sur les cartes d'_valuation
Mai Logic Teran CX et Teran PX. A l'avenir, MorphOS fonctionnera sur d'autres 
machines PowerPC bas_es sur l'Open Firmware et peut-_tre m_me sur certains Apple
Macintosh PowerPC.

ö

\T


Il fonctionne pr_sentement sur les processeurs PowerPC 603e, 604e, 750 et 7400
(G4 original).

MorphOS le bien nomm_ est un amalgame du vieux et du neuf. A l'origine, en 1995, 
il devait _tre une solution migratoire pour faire passer l'Amiga au PowerPC mais 
ils devint finalement un syst_me d'exploitation a part enti_re compatible avec 
les applications Amiga. A l'avenir, il va encore _voluer pour devenir un vrai 
syst_me d'exploitation moderne et tr_s avanc_. N_anmoins, il gardera sa 
compatibilit_ avec les applications existantes au travers de son syst_me "d'OS Boxes".

~\ A l'Origine - L'Histoire de MorphOS

Pour prendre un peu de recul et _tre le plus exhaustif, avant de rentrer plus dans
les d_tails, cette section va d_crire comment le projet MorphOS a d_but_ et a 
_volu_ dans le temps.

La voie longue et tortueuse du PowerPC sur Amiga a commenc_ en 1995. Bien qu'il y a 
eu et qu'il y a encore d'autres projets similaires, avec MorphOS 1.0, le projet 
original est enfin en phase terminale.

En septembre 1995, un accord est pass_ entre Amiga Technologies et la compagnie 
allemande Phase 5 avec pour but de d_velopper un chemin de transition pour passer 
de la famille de processeurs 680x0 (68k), qui arrivait en fin de vie, vers la 
famille PowerPC, ceci fut la gen_se du projet MorphOS.

ö

\T


Malheureusement, cet accord fut de courte dur_e puisque Escom, la compagnie 
d_tenant Amiga Technologies fit faillite. N_anmoins, le projet ne tomba pas aux 
oubliettes puisque Phase 5 d_cida d'aller de l'avant et continuer le processus 
de migration. Ceci amena Phase 5 a sortir en 1997 une s_rie de cartes acc_l_ratrices
nomm_e PowerUP qui, pour la premi_re fois, apportaient a l'Amiga une acc_l_ration 
RISC. Les programmes fonctionnaient sur le 68k et certaines fonctions _taient 
acc_l_r_es par l'usage du PowerPC et d'une biblioth_que PPC native.

Il y eut beaucoup de projets et d'accords entre Phase 5 et d'autres compagnies mais 
avec tous les retournement de situations inh_rents a l'histoire de l'Amiga, les 
compagnies firent faillite et aucun de ces projets n'arriva a terme, m_me Phase 5 
fit faillite du au fait que le march_ Amiga d_clinait a vue d'oeil. Plus tard, 
une nouvelle soci_te vit le jour: BPlan fut form_e et le projet ressorti des cartons 
mais cette fois-ci, c'_tait dans l'optique de le concr_tiser en tant que Syst_me 
d'Exploitaion a part enti_re sans aucun composant du SE original. En 2000, alors 
qu'il arrivait au stage de d_veloppement final, MorphOS _tait r_v_l_ dans une 
version beta publique fonctionnant sur les carte PowerUP.

La version 2002 publique de MorphOS, d_voil_e sur le Pegasos PowerPC repr_sente le 
chapitre final de 7 ans de longue transition du mat_riel propri_taire bas_ sur le 
68k vers la plate-forme PowerPC. MorphOS n'a plus besoin du mat_riel original, il 
ne contient pas non plus d'_l_ment du syst_me original, mais ce qui est sur, c'est 
qu'il contient le m_me _tat d'esprit et les m_mes sensations : un ordinateur rapide
et fun a utiliser.

ö

\T

~\ La Structure de MorphOS

Le Syst_me MorphOS est bas_ sur le micronoyau Quark. Par dessus le noyau se 
trouvent actuellement 2 "Boxe". La premi_re, actuellement en stage final de
d_veloppement, est l'A-Box, la seconde toujours en d_veloppement est la Q-Box,
bien plus avanc_e technologiquement.

Au moment ou ces lignes sont _crite (Novembre 2002), le gros du d_veloppement se 
focalise sur l'A-Box mais un travail de design consid_rble a _t_ fait sur la Q-Box.

L'A-Box peut faire fonctionner les applications RTG (Re-Targetable Graphics) 
puisqu'il inclut une r_impl_mentation propre et compl_te de la version 3.1 de 
l'Amiga Operating System (AOS) ainsi qu'un _mulateur 68k JIT (Just In Time).

La Q-Box, d'autre part, sera nouvelle est requerra ses propres applications, mais 
puique la compatibilt_ avec les applications Amiga grace a l'A-Box est possible, 
MorphOS peut prendre son essor avec une base mature d'applications existantes 
pendant que le d_veloppement de la Q-Box continue.

Il est aussi possible que dans le futur, d'autres "boxes" soient ajout_es permettant
la compatibilit_ avec d'autres syst_mes d'exploitation. Les diff_rentes possibilt_s
sont d'ajouter la compatibilit_ avec les applications Unix/Linux ou celles de BeOS.
Notez bien que ce ne sont que des possibilit_s et des nombreux point doivent _tre 
pris en consid_ration avant d'ajouter la compatibilit_ avec ces syt_mes a MorphOS.

ö

\T

~\ L'A-Box

Le but original de MorphOS _tait de garder en vie l'Amiga en fournissant une voie 
de transition vers un mat_riel plus moderne.

Les utilisateurs peuvent d_ja lancer leurs applications d'origine sur d'autres 
plates-formes mais ceci fonctionne par l'_mulation du 68k et des chips propri_taires.
M_me si cette _mulation est compl_te et pr_cise, une bonne partie des performances
sont perdues dans l'_mulation elle-m_me.

Bien que MorphOS ait _volu_ vers un autre but que celui qu'il avait a ses orgines, 
il continue a garder la compatibilit_ avec l'AOS 3.1. N_anmoins, il utilise une 
technique diff_rente qui permet aux logiciels de tirer parti au maximum d'un 
mat_riel moderne. L'A-Box inclut un impl_menation propre de l'API de l'AOS3.1, 
cr__e en utilisant des documentations disponibles publiquement. Elle a _t_ _crite 
et compil_e sur PowerPC et est donc 100% native. Il y a aussi l'_mulateur 68k 
pour les applications existantes, les performances de ces derni_res sont 
acc_l_r_es de mani_res substantielle par le compilateur a la vol_e JIT (Just In 
Time) qui convertit le code 68k en code PowerPC et ensuite les met en cache, 
r_duisant de facon drastique la lourdeur de l'_mulation. En plus d'_tre native, 
l'A-Box est plus rapide que l'original pour ce qui est de faire fonctionner 
les applications, ceci grace a diff_rentes techniques et aussi au fait qu'elles 
sont utilis_es justement dans ce syst_me. Ceci permet une acc_l_ration notable 
dans les performances syst_me.

ö

\T


Pour un maximum de performances, il est n_anmoins tr_s simple de compiler du code 
en natif PPC. Cela permet aux applications Amiga de tirer pleinement profit des 
performances du PowerPC.

Un point qu'il est tout de m_me important de noter: il n'y a aucune _mulation 
des chipsets propri_taires de l'Amiga. Par cons_quent, MorphOS ne peut lancer par 
lui-m_me des applications les requ_rant. Ce n'est pas vraiment un probl_me en 
lui-m_me puique l'on peut imaginer que depuis les avanc_es de l'AOS 2.0, les 
applications ont eu la possibilit_ d'utiliser des appels de l'API ind_pendants 
du mat_riel. Si un utilisateur veut lancer des applications requerrant les chips 
propri_taires (par ex. beaucoup de jeux), ils peuvent utiliser UAE (Ubiquitous 
Amiga Emulator), il _mule la totalit_ de hardware Amiga et existe sur beaucoup 
de plates-fromes, dont MorphOS.

L'AOS originel fonctionnait sur des machines maintenant obsol_tes qui ne poss_dent
qu'une fraction de la puissance disponible sur les microprocesseurs actuels. Les 
vitesses des Amiga _taient not_es en MIPS (Millions d'Instructions Par Seconde),
l'IBM G3 a 1 Ghz est plus de 2000 fois plus rapide que l'Amiga 68000 d'origine.
Malgr_ cela, la rapidit_ et les temps de r_ponse des Amiga originaux _taient -et
sont encore- tr_s _lev_s. Par cons_quent, _tant donn_ que l'A-Box fournit une 
impl_mentation PPC des plus efficaces, ses temps de r_ponse vont paraitre 
extr_mement rapides a un utilisateur de PC, surtout lorsque l'on sait que c'est 
sur une machine initiale dont la vitesse n'est que de 600 Mhz.

ö

\T

- Support des Syst_me de Fichiers
MorphOS supporte un grand nombre de Syst_mes de Fichiers et d'autres peuvent _tre
support_s par l'ajout de plug-ins :
OFS (Original File System)
FFS (Fast File System)
FFS 2 (Fast File System 2)
PFS 3 (Professional File System 3)
SFS (Smart File System)

- Relaxez-vous - Ambient Desktop
L'environnement MorphOS de remplacement du Workbench se nomme Ambient et faisant 
partie int_grante de l'A-Box agit comme l'environnement qu'il _mule. Il a la 
possibilit_ de tirer avantage des changements et avanc_es du syst_me graphique, 
donc contrairement aux Workbench Amiga, il supporte les affichages 24 bits et 
blendings. L'affichage du contenu d'une fen_tre pendant qu'elle est d_plac_e 
est une autre caract_ristique du syst_me graphique utilis_ par Ambient. MUI 
(Magic User Interface) fait aussi partie d'Ambient, lui conf_rant un haut degr_ 
de personnalisation.

- Les Autres Am_liorations Graphiques
Contrairement a l'original, le syst_me graphique est maintenant compl_tement 
ind_pendant du m_t_riel, il a aussi _t_ consid_rablement am_lior_ avec de 
nouvelles fonctionnalit_s telles que la transparence et l'overlay. L'acc_l_ration
graphique 3D est impl_ment_e grace a l'API Rave3D et un wrapper pour l'API 
Warp3D est en d_veloppement, la compatibilit_ OpenGL est aussi pr_vue.

ö

\T

Le syst_me audio a aussi _t_ am_lior_ avec l'ajout de AHI qui est une API de 
redirection pour l'audio de facon a ce que les applications puissent tirer 
avantage des syst_mes avec des p_riph_riques audio meilleurs que l'original 
(de nos jours, tous le sont).

A sa sortie, l'AOS _tait un syst_me d'exploitation tr_s en avance, il incluait 
le multitache pr_emptif d_s 1985 -une caract_ristique que les autres SE (Windows
ou MacOS) n'ont eu que bien plus tard. N_anmoins, compar_ aux syst_mes d'exploitaion
modernes, l'Amiga poss_de pas mal de limitations telles que le manque de protection
m_moire ou l'absence de m_moire virtuelle.

Comme il inclut une r_impl_mentation fid_le des sp_cifications de l'API de l'AOS 3.1,
le design de l'A-Box _tait en grande partie fig_ et ne pouvait _tre compl_tement
modifi_e. Par cons_quent, l'A-Box poss_de beaucoup de limitations pr_sentes dans
l'original. Certaines ont _t_ contourn_es grace a des extensions mais pour
certains cas, les limitaions sont soit trop difficiles soit impossibles a retirer 
sans supprimier compl_tement la compatibilit_ avec les applications. Cependant,
ce sont des limitations de l'A-Box et pas de MorphOS en g_n_ral, la Q-Box n'aura 
pas ces probl_mes.

~\ Q - Le Futur de MorphOS

- La Q-Box

Jusqu'a maintenant, le d_veloppement s'est concentr_ sur l'A-Box. Dans le futur, 
il devrait se focaliser sur Q.

ö

\T

Q devrait consister en une version am_lior_e du noyau Quark, un ensemble de 
serveurs fournissant la fonctionnalit_ n_cessaire et la Q-Box dans laquelle les 
applications tourneront. Le noyau Quark est vraiement petit, il fournit une couche 
d'abstraction mat_riel, des pilotes, la gestion de la m_moire, transmission des 
messages. La plupart du vrai travail sera fait dans les serveurs (R_seau, Syst_me 
de Fichiers, GUI, Media, S_curit_, graphismes 2D/3D, etc...).

Les applications devraient tourner dans la Q-Box et faire des appels d'API via un 
syst_me de transmission de message. L'API ne sera pas ferm_e par un seul langage 
de programmation et les d_vloppeurs n'auront pas a apprendre un nouveau langage. 
La transmission de message est extr_mement rapide, au lieu de transf_rer les 
donn_es dans le message, la position m_moire du message est remapp_e vers 
l'application en attente du message. Les petits messages sont copi_s directement 
_tant donn_ que cette m_thode est plus rapide pour les petits paquets de donn_es.

- Modularit_ et Autres Petites Choses.

Le syst_me de transmission de message utilis_ dans MorphOS signifie que le syst_me 
peut _tre grandement modulable. Les composants envoyant et recevant les messages 
peuvent tourner sur diff_rentes processeurs ou m_me sur diff_rents ordinateurs et 
le message arrivera toujours a destination. Un syst_me de fen_trage par dessus un 
r_seau (a la X-Window) pourrait _tre impl_ment_ de cette mani_re mais les temps 
de r_cation en souffriraient. Un wrapper compatible X-Window est pr_vu de telle 
sorte que les applications X-Window puissent _tre port_es mais les r_sultats en 
terme de vitesse sur l'environnement seront tr_s diff_rentes de celles utilisant 
les impl_mentations actuelles de X-Window.

ö

\T


La capacit_ de distributions de Q en terme de transmission de message signifie que 
le clustering sera possible sans avoir a r__crire le SE tout entier. Les applications
requerrant un grand nombre de processeurs seront relativement faciles a _crire sous
Q. Une des choses requise par les applications a grande _chelle est une grande 
quantit_ de m_moire, les stations de travail et autres grands serveurs sont en 64 
bits depuis plusieurs ann_es d_ja mais ils sont encore loin d'avoir le niveau 
d'utilisation qu'un utilisateur de base attend d'un Syst_me d'Exploitation. Q a 
_t_ concu d_s le d_part avec une optique 64 bits. Les applications auront d_s le 
d_but acc_s a une gamme d'adresses bien plus vaste que ce qui existe dans les 
Syst_mes d'Exploitation actuels.

- Microkernel Vs Macro Kernel

Un probl_me courament rencontr_ dans le d_velopmment d'un Syst_me d'Exploitation 
bas_ sur un micronoyau est la vitesse. Cela est du au fait qu'il y a _norm_ment de 
changements de contexte faits par le CPU entre le noyau et les processus. Le context
switching ralentit _norm_ment la machine. La cons_quence de ce probl_me est que 
beaucoup de syst_me d'exploitation se sont d_tach_s du micronoyau pour s'approcher 
plus d'un macronoyau en ajoutant des fonctionnalit_s au noyau, par exemple Microsoft
a d_plac_ les graphiques dans le noyau de WindowsNT, Be a fait de m_me avec les 
capacit_ r_seau de son SE, Linux a commenc_ comme un macronoyau et tout est inclu 
dedans. Cette technique apporte un gain de vitesse mais au prix de la stabilit_ et 
de la s_curit_ puisque diff_rentes taches du noyau peuvent _crire a l'emplacement 
m_moire d_ja occup_ par l'une d'entre elles.

ö

\T

Etant donn_ ce qui est _crit au-dessus, l'on peut se demander pourquoi Q peut _tre 
bas_ sur un micronoyau (pour _tre plus pr_cis, il s'apparente a un micronoyau) et 
quand m_me esp_rer de bonnes performances. La r_ponse a cette question vient du 
fait que MorphOS tourne sur PowerPC et non sur des processeurs x86. C'est un 
probl_me de l'architecture x86 qui fait que les context switches sont tr_s gourmands
en temps processeur. Les changements de contexte sur PowerPC sont de l'ordre de 
10 fois plus rapides, se rapprochant de la vitesse d'appel d'une sous-routine. 
Cela veut dire qu'un Syst_me d'Exploitaion PowerPC peut utiliser une architecture
micronoyau avec tous les avantages possibles sans la perte de vitesse de 
changement de contexte. Il n'y a aucun projet pour ce qui est de d_velopper une 
version x86 de MorphOS, si cela devait arriver, il y aurait sans aucun doute des 
changements internes a faire pour s'accomoder de cette arhitecture processeur 
diff_rente.

- Transition

Au moment ou ces lignes sont _crites, le noyau Quark existe mais est incomplet. Le 
reste de Q est toujours en phase de pr_vision, le plus gros a _t_ _tabli mais les 
menus d_tails ne le sont pas encore completement. Les pilotes par exemples sont 
inclus dans l'A-Box d'ou ils peuvent acc_der directement au mat_riel. A l'avenir, 
les pilotes seront incorpor_s au noyau Quark ou ils seront ind_pendants de l'A-Box
et bien sur des autres "boxes", ce qui a l'avantage de les rendre utilisables par
toutes les autres boxes. Cette direction a _t_ pr_-_tablie, les pilotes ont donc 
_t_ _crits avec ceci a l'esprit et le changement devrait _tre realtivement trivial
a op_rer.

ö

\T

- Vapour Where ? (Vapor Ou ? -Jeu de mots Vaporware).

La grande partie des informations donn_es ici a propos de la Q-Box sont au futur et
ceci pourrait donner l'occasion de nous taxer de faire du vapourware (le fait 
d'annoncer un logiciel longtemps a l'avance et ne rien sortir). Nous d_crivons 
seulement nos buts et comment nous comptons y parvenir. N_anmoins, comme il est 
normal dans le monde informatique, les choses changent donc tout ceci peut _tre 
modifi_. Le d_veloppement de syst_mes complexes prend toujours beaucoup de temps, 
nous cherchons des solutions pour arriver sur le march_ le plus rapidement 
possible mais le produit final mettra du temps a _tre concr_tis_.

Le futur am_liorera le travail d_ja r_alis_ et apportera aux utilisateurs de 
MorphOS un Syst_me d'Exploitation r_solument moderne, d_sign_ et construit par
des d_veloppeurs ayant une longue exp_rience derri_re eux, qui connaissent les
b_n_fices et les avantages du pass_ mais qui ont aussi le savoir et l'exp_rience
de ce qu'il ne faut pas faire et des chemins a ne pas prendre.

- Mise a jour de Nicholas Blachford :

Quelques changements sont a apporter a la doc : premi_rement, l'expression 
"Compatibilit_ Amiga" est impropre, ce n'est pas ce que nous voulons affirmer.
Nous sommes compatibles avec les applications Amiga.

Deuxi_me chose, il y a confusion a propos des pilotes qui seront inclus dans le 
noyau, il ne seront pas dans le noyau lui-m_me comme mentionn_.

ö

\T

Liste des Caract_ristiques :
Nous travaillons dessus, je ne sais pas quand elle sera pr_te cependant.

Le Futur Plus en D_tail :
Ecrire un OS comme Q est tr_s prenant et peut tr_s bien prendre plusieurs ann_es
pour _tre achev_. Il n'y a pas a l'heure actuelle de pr_vision certaine pour le 
futur, de plus cela _voluerait surement au fil du temps. Nous esp_rons avoir 
quelquechose bientot, mais de quelle facon, c'est ce que nous nous demandons.

A la question de savoir si dans 5 ans l'_quipe de BPlan sera toujours la, Nicholas
r_pond : les gens qui ont fond_ cette compagnie d_veloppent sur Amiga depuis tr_s 
longtemps et voient ce projet comme un investissement a long terme. Ils d_pensent 
beaucoup d'argent pour lui et ce serait une attitude absurde d'abandonner apr_s 
une courte p_riode.

~\ Informations Suppl_mentaires
Pour des nouvelles de MorphOS et des liens: http://www.morphos-news.de
Pour plus de d_tails sur le Pegasos: http://www.pegasosppc.com
v1.1 Copyright <C) Thendic-France SARL November 2002

Tous les termes et noms utilis_s ici sont des marques d_pos_es et restent 
propri_t_s de leurs d_tenteurs.

ö